(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10f1222a"],{"09b7":function(t,e,o){"use strict";o.r(e);var s,n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"className"},[o("el-card",[o("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n      编辑工作流\n    ")]),o("div",{staticClass:"box"},[o("el-tabs",{on:{"tab-click":t.changeTab},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"基本信息",name:"baseInfo"}},[o("div",{staticClass:"formClass"},[o("el-form",{ref:"baseInfoForm",staticClass:"demo-ruleForm",attrs:{model:t.baseInfoForm,"status-icon":"","label-width":"auto",rules:t.rules}},[o("el-form-item",{attrs:{label:"工作流名称",prop:"name"}},[o("el-input",{staticStyle:{width:"20vw"},attrs:{type:"text",autocomplete:"off"},model:{value:t.baseInfoForm.name,callback:function(e){t.$set(t.baseInfoForm,"name",e)},expression:"baseInfoForm.name"}})],1),o("el-form-item",{attrs:{label:"工作流说明",prop:"intro"}},[o("el-input",{staticStyle:{width:"20vw"},attrs:{type:"textarea",autocomplete:"off"},model:{value:t.baseInfoForm.intro,callback:function(e){t.$set(t.baseInfoForm,"intro",e)},expression:"baseInfoForm.intro"}})],1)],1),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.submitBaseInfo}},[t._v("保存&下一步")]),o("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1)]),o("el-tab-pane",{attrs:{label:"状态定义",name:"statusSet"}},[o("div",{staticClass:"searchDiv"},[o("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addStatus}},[t._v("添加状态")])],1),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.statusList,border:""}},[o("el-table-column",{attrs:{prop:"name",label:"状态名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tag",[t._v(t._s(e.row.name))])]}}])}),o("el-table-column",{attrs:{prop:"intro",label:"状态说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.intro?e.row.intro:"-")+"\n              ")]}}])}),o("el-table-column",{attrs:{prop:"name",label:"起始状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"radio",name:"begin",value:"1"},domProps:{checked:1==e.row.is_begin},on:{click:function(o){return t.handleBegin(e.$index)}}})]}}])}),o("el-table-column",{attrs:{prop:"name",label:"结束状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"checkbox",name:"end",value:"1"},domProps:{checked:1==e.row.is_end},on:{click:function(o){return t.handleEnd(e.$index)}}})]}}])}),o("el-table-column",{attrs:{prop:"create_time",label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.editSatus(e.row,e.$index)}}},[t._v("编辑")]),o("el-popconfirm",{attrs:{title:"你确定要删除吗？",confirmButtonType:"danger"},on:{confirm:function(o){return t.delStatus(e.$index)}}},[o("el-button",{staticStyle:{"margin-left":"8px"},attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.submitStatusInfo}},[t._v("保存&下一步")]),o("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1),o("el-tab-pane",{attrs:{label:"流转设置",name:"flowSet"}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.flowList,border:""}},[o("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                从【"+t._s(e.row.src_status)+"】中可流转到\n              ")]}}])}),t._l(t.flowList,(function(e,s){return o("el-table-column",{key:s,attrs:{label:e.src_status},scopedSlots:t._u([{key:"default",fn:function(s){return[o("input",{attrs:{type:"checkbox"},domProps:{checked:s.row.dst_status.includes(e.src_status)},on:{click:function(o){return t.handleFlow(s.$index,e.src_status)}}})]}}],null,!0)})}))],2),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.sumbitFlowInfo}},[t._v("保存")])],1)],1)],1)],1)]),o("el-dialog",{attrs:{width:"30vw",title:"mod"==t.formType?"修改状态":"新增状态",visible:t.statusDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.statusDialog=e},closed:t.closedDialog}},[o("el-form",{ref:"statusForm",attrs:{"label-width":"auto",model:t.statusForm,rules:t.statusRules}},[o("el-form-item",{attrs:{label:"状态名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入状态名称"},model:{value:t.statusForm.name,callback:function(e){t.$set(t.statusForm,"name",e)},expression:"statusForm.name"}})],1),o("el-form-item",{attrs:{label:"状态说明",prop:"intro"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入状态说明"},model:{value:t.statusForm.intro,callback:function(e){t.$set(t.statusForm,"intro",e)},expression:"statusForm.intro"}})],1)],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.statusDialog=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.submitStatus}},[t._v("确 定")])],1)],1)],1)},a=[],i=o("bd86"),r=o("75fc"),l=(o("7f7f"),o("24d2")),u=(s={data:function(){return{type:"add",project_id:"",flow_id:"",activeName:"baseInfo",baseInfoForm:{name:"",intro:""},rules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},statusList:[],selectedOption:"",formType:"add",statusDialog:!1,statusForm:{name:"",intro:"",is_begin:0,is_end:0},statusRules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},activeStatusIndex:null,flowList:[]}},computed:{},components:{},filters:{},created:function(){this.project_id=this.$route.params.project_id,this.flow_id=this.$route.params.flow_id,this.type=this.$route.params.type,"mod"==this.type&&(this.flowInfo(),this.flowStatus())},onLoad:function(t){},onShow:function(){},mounted:function(){}},Object(i["a"])(s,"computed",{}),Object(i["a"])(s,"methods",{flowInfo:function(){var t=this;Object(l["i"])({flow_id:this.flow_id}).then((function(e){t.baseInfoForm.name=e.data.name,t.baseInfoForm.intro=e.data.intro}))},sumbitFlowInfo:function(){var t=this;Object(l["d"])({flow_id:this.flow_id,actions:JSON.stringify(this.flowList)}).then((function(e){0==e.code&&t.$message({message:"保存流程成功",type:"success"})}))},flowActions:function(){var t=this;Object(l["e"])({flow_id:this.flow_id}).then((function(e){console.log(e),t.flowList=e.data}))},handleFlow:function(t,e){var o=this.flowList[t].dst_status.indexOf(e);this.flowList[t].dst_status=-1!==o?[].concat(Object(r["a"])(this.flowList[t].dst_status.slice(0,o)),Object(r["a"])(this.flowList[t].dst_status.slice(o+1))):[].concat(Object(r["a"])(this.flowList[t].dst_status),[e])},handleBegin:function(t){this.statusList.map((function(e,o){e.is_begin=t==o?1:0}))},handleEnd:function(t){this.statusList[t].is_end=1==this.statusList[t].is_end?0:1,console.log(this.statusList)},flowStatus:function(){var t=this;Object(l["k"])({flow_id:this.flow_id}).then((function(e){0==e.code&&(t.statusList=e.data?e.data:[])}))},submitStatusInfo:function(){var t=this;0!=this.statusList.length?Object(l["l"])({project_id:this.project_id,flow_id:this.flow_id,status:JSON.stringify(this.statusList)}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.activeName="flowSet",t.flowActions())})):this.$message({message:"请添加状态",type:"warning"})},closedDialog:function(){this.$refs["statusForm"].clearValidate(),this.statusForm={name:"",intro:"",is_begin:0,is_end:0},this.formType="add"},submitStatus:function(){var t=this;this.$refs["statusForm"].validate((function(e){e&&("mod"==t.formType?(t.$set(t.statusList,t.activeStatusIndex,t.statusForm),t.statusDialog=!1):(t.statusList.push(t.statusForm),t.statusDialog=!1))}))},addStatus:function(){this.formType="add",this.statusDialog=!0},delStatus:function(t){this.statusList.splice(t,1)},editSatus:function(t,e){this.activeStatusIndex=e,this.statusForm.name=t.name,this.statusForm.intro=t.intro,this.statusForm.is_begin=t.is_begin,this.statusForm.is_end=t.is_end,this.formType="mod",this.statusDialog=!0},submitBaseInfo:function(){var t=this;this.$refs["baseInfoForm"].validate((function(e){if(e)if("mod"==t.type){var o={};o.flow_id=t.flow_id,o.project_id=t.project_id,o.name=t.baseInfoForm.name,o.intro=t.baseInfoForm.intro,Object(l["j"])(o).then((function(e){t.$message({message:"修改成功",type:"success"}),t.activeName="statusSet"}))}else{var s={};s.project_id=t.project_id,s.name=t.baseInfoForm.name,s.intro=t.baseInfoForm.intro,Object(l["f"])(s).then((function(e){t.$message({message:"新增成功",type:"success"}),t.flow_id=e.data.flow_id,t.activeName="statusSet"}))}}))},back:function(){this.$router.go(-1)},changeTab:function(t){"flowSet"==t.name&&this.flowActions()}}),s),c=u,f=(o("f594"),o("2877")),d=Object(f["a"])(c,n,a,!1,null,"2e83867c",null);e["default"]=d.exports},"24d2":function(t,e,o){"use strict";o.d(e,"g",(function(){return a})),o.d(e,"m",(function(){return i})),o.d(e,"h",(function(){return r})),o.d(e,"f",(function(){return l})),o.d(e,"j",(function(){return u})),o.d(e,"i",(function(){return c})),o.d(e,"d",(function(){return f})),o.d(e,"e",(function(){return d})),o.d(e,"k",(function(){return m})),o.d(e,"l",(function(){return p})),o.d(e,"a",(function(){return h})),o.d(e,"c",(function(){return b})),o.d(e,"n",(function(){return w})),o.d(e,"b",(function(){return v}));var s=o("365c"),n={addProject:"add",editProject:"mod",getProjectList:"list",delProject:"del",flowStautsMod:"flowStautsMod",flowStatus:"flowStatus",flowActions:"flowActions",flowActionMod:"flowActionMod",flowInfo:"flowInfo",flowMod:"flowMod",flowAdd:"flowAdd",flowDel:"flowDel",flowList:"flowList",flowChartMod:"flowChartMod"};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowChartMod,t,"api/project")}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowList,t,"api/project")}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowDel,t,"api/project")}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowAdd,t,"api/project")}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowMod,t,"api/project")}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowInfo,t,"api/project")}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowActionMod,t,"api/project")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowActions,t,"api/project")}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowStatus,t,"api/project")}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.flowStautsMod,t,"api/project")}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.addProject,t,"api/project")}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.editProject,t,"api/project")}function w(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.getProjectList,t,"api/project")}function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["a"].post(n.delProject,t,"api/project")}},"45f6":function(t,e,o){},f594:function(t,e,o){"use strict";var s=o("45f6"),n=o.n(s);n.a}}]);