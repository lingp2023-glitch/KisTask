(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74d7c5b6"],{"0bba":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"picWrap"}},[i("el-dialog",{staticClass:"big",attrs:{top:"10px",visible:e.dialogVisible,width:"55vw","append-to-body":"","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t},open:e.openhandle}},[i("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"header-top"},[i("div",{staticClass:"title"},[e._v("图片库")]),i("transition",{attrs:{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.selectArr.length,expression:"selectArr.length"}],staticClass:"img-select-list"},[i("div",{staticClass:"len"},[e._v("\n              共选择\n              "),i("el-link",{staticClass:"link-a",attrs:{icon:"el-icon-picture",type:"primary"}},[e._v(e._s(e.selectArr.length))]),e._v("张图片\n            ")],1),i("div",{staticClass:"link-wrap"},[i("el-link",{staticClass:"link-a close",attrs:{icon:"el-icon-close",underline:!1,type:"primary"},on:{click:e.closeSelect}},[e._v("全部取消")]),i("el-link",{staticClass:"link-a del",attrs:{icon:"el-icon-delete",underline:!1,type:"primary"},on:{click:e.delSelect}},[e._v("删除")])],1)])])],1)]),i("div",{staticClass:"body"},[i("div",{staticClass:"grounp-wrap"},[i("el-popover",{attrs:{placement:"right",width:"300",trigger:"click"},model:{value:e.disabled,callback:function(t){e.disabled=t},expression:"disabled"}},[i("div",{staticClass:"addGroup"},[i("el-input",{attrs:{placeholder:"请输入组名"},model:{value:e.group_name,callback:function(t){e.group_name=t},expression:"group_name"}}),i("div",{staticClass:"add-btn"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addResGroup}},[e._v("添加")])],1)],1),i("el-button",{attrs:{slot:"reference",plain:"",type:"primary",size:"mini",icon:"el-icon-plus"},slot:"reference"},[e._v("新增分组")])],1),i("upload",{attrs:{group_id:e.group_id,groupList:e.groupList},on:{"after-upload":function(t){return e.getImgList(e.imgData.page)}}})],1),i("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.toggleGroup},model:{value:e.group_id,callback:function(t){e.group_id=t},expression:"group_id"}},[i("el-tab-pane",{attrs:{name:"0"}},[i("span",{staticClass:"label",attrs:{slot:"label"},on:{click:e.removeRe},slot:"label"},[e._v("未分组")]),i("tab-item",{attrs:{selectArr:e.selectArr,imgData:e.imgData,multiple:e.multiple,groupList:e.groupList},on:{"update:selectArr":function(t){e.selectArr=t},"update:select-arr":function(t){e.selectArr=t},selectFin:e.selectEmit}})],1),e._l(e.groupList,function(t){return i("el-tab-pane",{key:t.group_id,attrs:{name:t.group_id}},[i("div",{staticClass:"tabItem",attrs:{slot:"label"},on:{click:function(i){return e.mouseOver(t.group_id)}},slot:"label"},[i("span",{staticClass:"label"},[e._v(e._s(t.group_name))]),i("el-popover",{ref:"labPop",refInFor:!0,attrs:{placement:"right",width:"190",trigger:"click","v-model":e.activeId==t.group_id}},[i("div",{staticClass:"setBtnClass"},[i("el-popover",{ref:"setPop",refInFor:!0,attrs:{placement:"right",width:"300",trigger:"click","v-model":e.activeId==t.group_id}},[i("div",{staticClass:"modGroup"},[i("el-input",{attrs:{placeholder:"请输入新组名"},model:{value:e.group_name,callback:function(t){e.group_name=t},expression:"group_name"}}),i("div",{staticClass:"mod-btn"},[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.modResGroup(t.group_id)}}},[e._v("修改")])],1)],1),i("el-button",{attrs:{slot:"reference",type:"primary",icon:"el-icon-edit"},on:{click:function(i){return e.editTab(t.group_name)}},slot:"reference"},[e._v("编辑")])],1),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(i){return e.removeTab(t.group_id)}}},[e._v("删除")])],1),i("i",{directives:[{name:"show",rawName:"v-show",value:e.activeId==t.group_id,expression:"activeId == item.group_id"}],staticClass:"el-icon-setting settingIcon",attrs:{slot:"reference"},nativeOn:{click:function(e){e.stopPropagation()}},slot:"reference"})])],1),i("tab-item",{attrs:{selectArr:e.selectArr,imgData:e.imgData,multiple:e.multiple,groupList:e.groupList},on:{"update:selectArr":function(t){e.selectArr=t},"update:select-arr":function(t){e.selectArr=t},selectFin:e.selectEmit}})],1)})],2)],1),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"","current-page":e.imgData.page,"page-size":e.imgData.page_size,layout:"total, prev, pager, next",total:e.imgData.total_count},on:{"current-change":e.handleCurrentChange}})],1)])],1)},a=[],s=(i("7f7f"),i("20d6"),i("cebc")),n=i("ae4a"),l=i("2f62"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"imgWrap"},[e.showViewer?i("el-image-viewer",{attrs:{"on-close":e.closeViewer,"url-list":[e.viewSrc],zIndex:9999}}):e._e(),e.imgData.list&&0!=e.imgData.list.length?[e._l(e.imgData.list,function(t){return i("div",{key:t.image_id,staticClass:"box-card",class:{"border-gray":e.checkSelect(t.image_id)},on:{click:function(i){return e.select(t)}}},[i("div",{staticClass:"pic"},[i("el-image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.base_img+t.min_file,fit:"cover"}})],1),i("div",{staticClass:"name"},[i("i",{staticClass:"el-icon-zoom-in preview",on:{click:function(i){return i.stopPropagation(),e.onPreview(t)}}}),i("div",{staticClass:"file_name"},[e._v(e._s(t.file_name))])]),i("div",{staticClass:"controlBtn"},[i("i",{staticClass:"el-icon-edit iconStyel",on:{click:function(i){return i.stopPropagation(),e.edit(t)}}}),i("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{confirm:function(i){return e.del(t)}}},[i("i",{staticClass:"el-icon-delete iconStyel",attrs:{slot:"reference"},on:{click:function(e){e.stopPropagation()}},slot:"reference"})])],1),i("div",{staticClass:"checked",class:{"opacity-toggle":e.checkSelect(t.image_id)}},[i("i",{staticClass:"el-icon-check icon"})])])}),i("el-dialog",{attrs:{title:"编辑",visible:e.dialogVisible,width:"30%","append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"","label-width":"auto"}},[i("el-form-item",{attrs:{label:"分组",prop:"group_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分组"},model:{value:e.ruleForm.group_id,callback:function(t){e.$set(e.ruleForm,"group_id",t)},expression:"ruleForm.group_id"}},[i("el-option",{attrs:{label:"未分组",value:"0"}}),e._l(e.groupList,function(e){return i("el-option",{key:e.group_id,attrs:{label:e.group_name,value:e.group_id}})})],2)],1),i("el-form-item",{attrs:{label:"名称",prop:"file_name"}},[i("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.ruleForm.file_name,callback:function(t){e.$set(e.ruleForm,"file_name",t)},expression:"ruleForm.file_name"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.editSubmit}},[e._v("确 定")])],1)],1)]:void 0],2)},c=[],u=i("d1eb"),d=i("08a9"),p={inject:["getImgList"],data:function(){return{showViewer:!1,viewSrc:"",dialogVisible:!1,ruleForm:{image_id:"",group_id:"0",file_name:""}}},props:{selectArr:{type:Array,required:!0},multiple:{type:Boolean,required:!0},imgData:{type:Object,required:!0},groupList:{type:Array,default:function(){return[]}}},components:{ElImageViewer:d["a"]},computed:Object(s["a"])({},Object(l["b"])(["base_img"]),{page_size:function(){return 5*Math.ceil(this.imgData.page_size/5)}}),methods:{onPreview:function(e){this.viewSrc=this.base_img+e.src_file,this.showViewer=!0},closeViewer:function(){this.showViewer=!1,this.viewSrc=""},edit:function(e){console.log(e),this.ruleForm.image_id=e.image_id,this.dialogVisible=!0},close:function(){},editSubmit:function(){var e=this,t=this.ruleForm,i=t.image_id,o=t.file_name,a=t.group_id,s={image_id:i,file_name:o,group_id:a};Object(u["u"])(s).then(function(t){0==t.code&&(e.$message({type:"success",message:"修改成功!"}),e.getImgList(1),e.dialogVisible=!1)})},del:function(e){var t=this;Object(u["h"])({imgs:e.image_id}).then(function(e){0==e.code&&(t.$message({type:"success",message:"删除成功!"}),t.getImgList(1),t.dialogVisible=!1)})},checkSelect:function(e){return this.selectArr.some(function(t){return t.image_id==e})},select:function(e){console.log(e,"obj"),this.$emit("selectFin",e)}}},g=p,m=(i("88bd"),i("2877")),f=Object(m["a"])(g,r,c,!1,null,null,null),h=f.exports,v={components:{tabItem:h,upload:n["b"]},provide:function(){return{getImgList:this.getImgList}},props:{appendToBody:{type:Boolean,default:function(){return!1}}},data:function(){return{dialogVisible:!1,selectArr:[],groupList:[],group_id:"0",group_type:1,imgData:{},group_name:"",multiple:!0,activeId:"",disabled:!1}},computed:Object(s["a"])({},Object(l["b"])(["base_img"]),{page_size:function(){return 5*Math.ceil(this.imgData.page_size/5)}}),methods:{modResGroup:function(e){var t=this;console.log(this.group_name,e,"提交新组名"),Object(u["v"])({group_name:this.group_name,group_id:e}).then(function(i){t.$message({message:"修改成功",type:"success"}),t.setDisabled=!1,t.group_name="",t.$refs.setPop.map(function(e,i){e.doClose(),t.$refs.labPop[i].doClose()}),t.getResGroups(),t.activeId=e,t.group_id=e})},removeTab:function(e){var t=this,i=this.groupList.findIndex(function(t){return t.group_id==e});this.$confirm("此操作将删除 ".concat(this.groupList[i].group_name," 分组, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(u["i"])({group_id:e}).then(function(e){0==e.code&&(t.groupList.splice(i,1),t.group_id="0",t.activeId="",t.toggleGroup({name:t.group_id}),t.$message({type:"success",message:"删除成功!"}))})})},editTab:function(e){console.log("点击了编辑功能"),this.group_name=e},mouseOver:function(e){console.log(e),this.activeId=e},removeRe:function(){this.activeId=""},clear:function(){this.$refs.fileUpload.value=""},handleClose:function(){this.group_name="",this.activeId="",this.disabled=!1,this.active="0",this.closeSelect(),this.dialogVisible=!1},selectEmit:function(e){console.log(e),this.$emit("getData",e),this.handleClose()},closeSelect:function(){this.selectArr.splice(0,this.selectArr.length)},delSelect:function(){var e=this,t=[];this.selectArr.map(function(e){t.push(e.image_id)}),Object(u["h"])({imgs:t.join(",")}).then(function(t){0==t.code&&(e.$message({type:"success",message:"删除成功!"}),e.getImgList(1),e.selectArr.splice(0,e.selectArr.length))})},handleCurrentChange:function(e){this.getImgList(e)},toggleGroup:function(e){this.group_id=e.name,this.getImgList(1)},openhandle:function(){this.getImgList(1),this.getResGroups()},open:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.multiple=e,console.log(this.multiple),this.dialogVisible=!0},close:function(){this.group_id="0",this.dialogVisible=!1},toggle:function(){this.dialogVisible=!this.dialogVisible},getImgList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=this.group_id;Object(u["n"])({page:t,group_id:i}).then(function(t){0==t.code&&(e.imgData=t.data)},function(e){console.log(e)})},getResGroups:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",i=this.group_type;Object(u["o"])({group_type:i}).then(function(i){e.groupList=i.data,e.active=t+""},function(e){console.log(e)})},addResGroup:function(){var e=this,t=this.group_type,i=this.group_name;""!=i?Object(u["d"])({group_type:t,group_name:i}).then(function(t){0==t.code&&(e.$message({type:"success",message:"添加成功!"}),e.disabled=!1,e.group_name="",console.log(t),e.getResGroups(t.data.group_id),e.activeId=t.data.group_id,e.group_id=t.data.group_id,e.toggleGroup({name:t.data.group_id}))},function(e){console.log(e)}):this.$message({message:"请输入组名",type:"warning"})}}},_=v,b=(i("d0a0"),Object(m["a"])(_,o,a,!1,null,"fb37d174",null));t["a"]=b.exports},"1c4c":function(e,t,i){"use strict";var o=i("9b43"),a=i("5ca1"),s=i("4bf8"),n=i("1fa8"),l=i("33a4"),r=i("9def"),c=i("f1ae"),u=i("27ee");a(a.S+a.F*!i("5cc5")(function(e){Array.from(e)}),"Array",{from:function(e){var t,i,a,d,p=s(e),g="function"==typeof this?this:Array,m=arguments.length,f=m>1?arguments[1]:void 0,h=void 0!==f,v=0,_=u(p);if(h&&(f=o(f,m>2?arguments[2]:void 0,2)),void 0==_||g==Array&&l(_))for(t=r(p.length),i=new g(t);t>v;v++)c(i,v,h?f(p[v],v):p[v]);else for(d=_.call(p),i=new g;!(a=d.next()).done;v++)c(i,v,h?n(d,f,[a.value,v],!0):a.value);return i.length=v,i}})},"5d64":function(e,t,i){},"5df3":function(e,t,i){"use strict";var o=i("02f4")(!0);i("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=o(t,i),this._i+=e.length,{value:e,done:!1})})},"88bd":function(e,t,i){"use strict";var o=i("9de6"),a=i.n(o);a.a},"9de6":function(e,t,i){},ae4a:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload"},[i("div",{on:{click:e.upLoadDia}},[e._t("btn",[i("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-upload2"}},[e._v("点击上传")])])],2),i("el-dialog",{attrs:{title:"上传图片",visible:e.dialogVisible,"before-close":e.handleClose,"close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"formData",attrs:{model:e.formData,"status-icon":"","label-width":"auto",rules:e.rules}},[i("el-form-item",{attrs:{label:"分组",prop:"group_id"}},[i("el-select",{staticStyle:{width:"30%"},attrs:{placeholder:"请选择分组"},model:{value:e.formData.group_id,callback:function(t){e.$set(e.formData,"group_id",t)},expression:"formData.group_id"}},[i("el-option",{attrs:{label:"未分组",value:"0"}}),e._l(e.groupList,function(e){return i("el-option",{key:e.group_id,attrs:{label:e.group_name,value:e.group_id}})})],2)],1),i("el-form-item",{attrs:{label:"本地素材",prop:"imgs"}},[i("el-upload",{ref:"Imageupload",attrs:{action:"","list-type":"picture-card","http-request":e.uploadImage,"on-remove":e.handleRemove,multiple:"",limit:8,accept:"image/png, image/jpeg, image/bmp","on-exceed":e.handleExceed}},[i("i",{staticClass:"el-icon-plus"})])],1)],1),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)],1)},a=[],s=(i("7f7f"),i("c5f6"),i("d1eb")),n={props:{group_id:{type:[String,Number],required:!0},groupList:{type:Array,required:!0,default:function(){return[]}}},data:function(){return{notify:"",dialogVisible:!1,formData:{group_id:"0",imgs:[]},rules:{group_id:[{required:!0,message:"请选择分组",trigger:"blur"}],imgs:[{required:!0,message:"请选择图片",trigger:"blur"}]},images:[]}},deactivated:function(){this.notify&&this.notify.close(),this.notify=null},methods:{submit:function(){var e=this;console.log("点击了提交"),this.$refs["formData"].validate(function(t){t&&(console.log(t),console.log(e.formData),e.addImage())})},addImage:function(){var e=this,t=this.formData.group_id,i=JSON.stringify(this.formData.imgs);Object(s["c"])({group_id:t,imgs:i}).then(function(t){0==t.code&&(e.$message({message:"图片上传成功！",type:"success"}),e.$emit("after-upload"),e.handleClose())})},upLoadDia:function(){this.dialogVisible=!0},handleClose:function(){this.$refs["formData"].clearValidate(),this.$refs["Imageupload"].clearFiles(),this.dialogVisible=!1,this.formData={group_id:"0",imgs:[]},this.images=[]},uploadImage:function(e){console.log(e),this.uploadPic(e.file)},handleRemove:function(e,t){console.log(e,t);var i="";this.images.map(function(t,o){t.uid==e.uid&&(i=o)}),this.images.splice(i,1),this.formData.imgs.splice(i,1),console.log(this.images),console.log(this.formData.imgs)},handleExceed:function(e,t){this.$message({type:"error",message:"当前限制选择 8 个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件")})},beforeRemove:function(e,t){return this.$confirm("确定移除 ".concat(e.name,"？"))},uploadPic:function(e){var t=this;this.notify||(this.notify=this.$notify({title:"请不要离开页面",duration:0,iconClass:"el-icon-loading",showClose:!1})),this.notify.message="正在上传",Object(s["x"])({file:e,type:0}).then(function(i){console.log(i),t.images.push({uid:e.uid,file:i.data.file}),t.formData.imgs.push(i.data.file),console.log(t.images),console.log(t.formData.imgs),t.notify.close(),t.$notify({title:"提示",message:"上传成功",type:"success",duration:1e3})},function(e){console.log(e)})}}},l=n,r=i("2877"),c=Object(r["a"])(l,o,a,!1,null,"30fbdbce",null),u=c.exports,d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload"},[i("div",{on:{click:function(t){return e.$refs.fileUpload.click()}}},[e._t("btn",[i("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-upload2"}},[e._v("点击上传")])])],2),i("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.multipleUploadFile}})])},p=[],g=(i("ac6a"),i("5df3"),i("1c4c"),i("96cf"),i("3b8d")),m={props:{group_id:{type:[String,Number],required:!0},type:{type:[String,Number],required:!0},group_type:{type:[String,Number],required:!0}},data:function(){return{}},methods:{multipleUploadFile:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,i,o,a,s,n,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=Array.from(this.$refs.fileUpload.files),i=0,o=t.length,a="",s=regeneratorRuntime.mark(function e(s){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a||(a=l.$notify({title:"上传中",duration:0,iconClass:"el-icon-loading",showClose:!1})),a.message="正在上传（".concat(s+1,"/").concat(o,"）"),n=t[s],e.next=5,l.upload(n).then(function(e){i+=e}).finally(function(){l.active=s+1});case 5:case"end":return e.stop()}},e)}),n=0;case 6:if(!(n<t.length)){e.next=11;break}return e.delegateYield(s(n),"t0",8);case 8:n++,e.next=6;break;case 11:a.close(),0!=t.length&&this.$notify({title:"提示",message:"上传".concat(t.length,"个资源，成功").concat(i,"个"),type:"success"}),this.$emit("after-upload"),this.$refs.fileUpload.value="";case 15:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),upload:function(){var e=this,t=this.$refs.fileUpload.files[0],i=this.type,o={};Object(s["x"])({file:t,type:i}).then(function(e){if(0==e.code){var t=e.data,i=t.file_name;t.file_size,t.url;o=i}},function(e){console.log(e)}).finally(function(){if(e.$refs.fileUpload.value="",3==e.group_type){var t=o,i=t.url;getVideoCover({file_url:i}).then(function(e){console.log(Object.assign(o,e.data))}).finally(function(){})}else if(2==e.group_type){var a=o,s=a.url;getAudioDuration({audio_file:s}).then(function(e){console.log(Object.assign(o,e.data))}).finally(function(){})}})}}},f=m,h=Object(r["a"])(f,d,p,!1,null,"7756d439",null),v=h.exports;i.d(t,"a",function(){return _});t["b"]=u;var _=v},d0a0:function(e,t,i){"use strict";var o=i("5d64"),a=i.n(o);a.a},f1ae:function(e,t,i){"use strict";var o=i("86cc"),a=i("4630");e.exports=function(e,t,i){t in e?o.f(e,t,a(0,i)):e[t]=i}}}]);