(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4786a8f0"],{"0fb5":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"className"},[o("el-card",[o("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n      编辑工作流\n    ")]),o("div",{staticClass:"box"},[o("el-tabs",{on:{"tab-click":t.changeTab},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"流程图",name:"flow"}},[o("div",{staticClass:"formBox"},[o("div",{staticClass:"boxLeft"},[o("div",{ref:"container",staticStyle:{height:"75vh"}})]),o("div",{staticClass:"boxRight"},[o("div",{staticStyle:{"margin-bottom":"15px"}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-plus",plain:""},on:{click:function(e){return t.addRectNode("start")}}},[t._v("起始状态")])],1),o("div",{staticStyle:{"margin-bottom":"15px"}},[o("el-button",{attrs:{type:"success",icon:"el-icon-plus",plain:""},on:{click:function(e){return t.addRectNode("process")}}},[t._v("过程状态")])],1),o("div",{staticStyle:{"margin-bottom":"15px"}},[o("el-button",{attrs:{type:"danger",icon:"el-icon-plus",plain:""},on:{click:function(e){return t.addRectNode("end")}}},[t._v("结束状态")])],1),o("div",{staticStyle:{"margin-bottom":"15px"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.confirmImport}},[t._v("重载")])],1),o("div",{staticStyle:{"margin-bottom":"60px"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.flowChartMod}},[t._v("保存流程")])],1),o("el-descriptions",{attrs:{title:"流程信息",column:1}},[o("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"名称"}},[t._v(t._s(this.baseInfoData.name))]),o("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"描述"}},[t._v(t._s(this.baseInfoData.intro))])],1),o("el-button",{attrs:{type:"primary"},on:{click:t.baseInfoMod}},[t._v("修改信息")])],1)])]),o("el-tab-pane",{attrs:{label:"状态定义",name:"statusSet"}},[o("div",{staticClass:"searchDiv"},[o("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addStatus}},[t._v("添加状态")])],1),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.statusList,border:""}},[o("el-table-column",{attrs:{prop:"name",label:"状态名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tag",[t._v(t._s(e.row.name))])]}}])}),o("el-table-column",{attrs:{prop:"intro",label:"状态说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.intro?e.row.intro:"-")+"\n              ")]}}])}),o("el-table-column",{attrs:{prop:"name",label:"起始状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"radio",name:"begin",value:"1"},domProps:{checked:1==e.row.is_begin},on:{click:function(o){return t.handleBegin(e.$index)}}})]}}])}),o("el-table-column",{attrs:{prop:"name",label:"结束状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"checkbox",name:"end",value:"1"},domProps:{checked:1==e.row.is_end},on:{click:function(o){return t.handleEnd(e.$index)}}})]}}])})],1)],1),o("el-tab-pane",{attrs:{label:"流转设置",name:"flowSet"}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.flowList,border:"","max-height":"65vh"}},[o("el-table-column",{attrs:{fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                从【"+t._s(e.row.src_status)+"】中可流转到\n              ")]}}])}),t._l(t.flowList,(function(e,i){return o("el-table-column",{key:i,attrs:{label:e.src_status},scopedSlots:t._u([{key:"default",fn:function(i){return[o("input",{attrs:{type:"checkbox"},domProps:{checked:i.row.dst_status.includes(e.src_status)},on:{click:function(o){return t.handleFlow(i.$index,e.src_status)}}})]}}],null,!0)})}))],2)],1)],1)],1)]),o("el-dialog",{attrs:{width:"30vw",title:"mod"==t.formType?"修改状态":"新增状态",visible:t.statusDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.statusDialog=e},closed:t.closedDialog}},[o("el-form",{ref:"statusForm",attrs:{"label-width":"auto",model:t.statusForm,rules:t.statusRules}},[o("el-form-item",{attrs:{label:"状态名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入状态名称"},model:{value:t.statusForm.name,callback:function(e){t.$set(t.statusForm,"name",e)},expression:"statusForm.name"}})],1),o("el-form-item",{attrs:{label:"状态说明",prop:"intro"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入状态说明"},model:{value:t.statusForm.intro,callback:function(e){t.$set(t.statusForm,"intro",e)},expression:"statusForm.intro"}})],1)],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.statusDialog=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.submitStatus}},[t._v("确 定")])],1)],1),o("el-dialog",{attrs:{width:"30vw",title:"编辑节点内容",visible:t.editModalVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.editModalVisible=e},closed:t.cancelEdit}},[o("el-form",{ref:"editingNodeForm",attrs:{"label-width":"auto",model:t.editingNodeData,rules:t.editingNodeRules}},[o("el-form-item",{attrs:{label:"节点名称",prop:"label"}},[o("el-input",{attrs:{placeholder:"请输入节点名称"},model:{value:t.editingNodeData.label,callback:function(e){t.$set(t.editingNodeData,"label",e)},expression:"editingNodeData.label"}})],1),o("el-form-item",{attrs:{label:"节点描述",prop:"content"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入节点描述"},model:{value:t.editingNodeData.content,callback:function(e){t.$set(t.editingNodeData,"content",e)},expression:"editingNodeData.content"}})],1)],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.cancelEdit}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.saveNodeContent}},[t._v("确 定")])],1)],1),o("el-dialog",{attrs:{width:"30vw",title:"修改流程信息",visible:t.baseInfoDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.baseInfoDialog=e},closed:t.closedBaseInfoDialog}},[o("el-form",{ref:"baseInfoForm",attrs:{"label-width":"auto",model:t.baseInfoForm,rules:t.baseInfoRules}},[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.baseInfoForm.name,callback:function(e){t.$set(t.baseInfoForm,"name",e)},expression:"baseInfoForm.name"}})],1),o("el-form-item",{attrs:{label:"描述",prop:"intro"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:t.baseInfoForm.intro,callback:function(e){t.$set(t.baseInfoForm,"intro",e)},expression:"baseInfoForm.intro"}})],1)],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialog=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.submitBaseInfo}},[t._v("确 定")])],1)],1)],1)},n=[],a=o("75fc"),r=(o("7f7f"),o("20d6"),o("e265")),s=o.n(r),l=o("a4bb"),c=o.n(l);function d(t,e){if(null==t)return{};var o,i,n={},a=c()(t);for(i=0;i<a.length;i++)o=a[i],e.indexOf(o)>=0||(n[o]=t[o]);return n}function f(t,e){if(null==t)return{};var o,i,n=d(t,e);if(s.a){var a=s()(t);for(i=0;i<a.length;i++)o=a[i],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(n[o]=t[o])}return n}o("96cf");var u=o("3b8d"),h=(o("55dd"),o("ac6a"),o("cebc")),p=o("24d2"),m=o("5728"),g=o("5118"),b=o("2f62"),v={data:function(){return{type:"add",project_id:"",flow_id:"",activeName:"flow",baseInfoData:{name:"",intro:""},baseInfoForm:{name:"",intro:""},baseInfoRules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},baseInfoDialog:!1,statusList:[],selectedOption:"",formType:"add",statusDialog:!1,statusForm:{name:"",intro:"",is_begin:0,is_end:0},statusRules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},activeStatusIndex:null,flowList:[],graph:null,nodes:[],edges:[],selectedNodeId:null,editModalVisible:!1,importModalVisible:!1,zoom:1,editingNodeId:null,importDataJson:"",editingNodeData:{label:"",content:"",color:"",type:""},flowData:"",editingNodeRules:{label:[{required:!0,message:"请输入节点名称",trigger:"blur"}]},connectingEnabled:!0}},components:{},filters:{},created:function(){var t=this;this.project_id=this.$route.params.project_id,this.flow_id=this.$route.params.flow_id,this.type=this.$route.params.type,"mod"==this.type&&(this.flowInfo(),this.flowStatus()),Object(g["setTimeout"])((function(){t.initGraph()}),0)},onLoad:function(t){},onShow:function(){},mounted:function(){},computed:Object(h["a"])({},Object(b["b"])(["nodesRegistered"])),beforeDestroy:function(){this.destroyGraph()},methods:{destroyGraph:function(){this.graph&&(this.graph.clearCells(),this.graph.dispose(),this.graph=null)},toggleConnecting:function(){var t=this;console.log(123456),this.connectingEnabled?this.graph.on("node:mouseenter",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="visible"}))})):this.graph.on("node:mouseenter",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="hidden"}))}))},extractNodeRelationships:function(t){for(var e="string"===typeof t?JSON.parse(t):t,o={},i=[],n=0;n<e.cells.length;n++){var a=e.cells[n];if("custom-rect"===a.shape){var r=a.id,s="";a.attrs&&a.attrs.label&&a.attrs.label.text?s=a.attrs.label.text:a.data&&a.data.label&&(s=a.data.label),o[r]=s}else"edge"===a.shape&&a.source&&a.source.cell&&a.target&&a.target.cell&&i.push({source:a.source.cell,target:a.target.cell})}var l={};for(var r in o)o.hasOwnProperty(r)&&(l[o[r]]=[]);for(var c=0;c<i.length;c++){var d=i[c],f=o[d.source],u=o[d.target];f&&u&&l[f].push(u)}var h=[];for(var s in l)l.hasOwnProperty(s)&&h.push({src_status:s,dst_status:l[s]});return h},flowSaveFlow:function(){var t=this;if(console.log(this.nodes.length),0!=this.nodes.length){var e=this.graph.toJSON(),o=JSON.stringify(e,null,2);this.importDataJson=o;var i=JSON.stringify(this.extractNodeRelationships(o));Object(p["d"])({flow_id:this.flow_id,actions:i}).then((function(e){0==e.code&&(t.$message({message:"保存流程成功",type:"success"}),t.flowActions())}))}else this.$message({message:"请添加状态",type:"warning"})},transformFlowData:function(t){var e="string"===typeof t?JSON.parse(t):t,o=e.cells.filter((function(t){return"custom-rect"===t.shape}));o.sort((function(t,e){return t.zIndex-e.zIndex}));var i=o.map((function(t){var e=t.data.type||"process",o=t.attrs||{},i=t.data||{};return{name:o.label&&o.label.text||i.label||"",intro:o.content&&o.content.text||i.content||"",is_begin:"start"===e?1:0,is_end:"end"===e?1:0}}));return i},flowSaveStatus:function(){var t=this;if(console.log(this.nodes.length),0!=this.nodes.length){var e=this.graph.toJSON(),o=JSON.stringify(e,null,2);this.importDataJson=o;var i=JSON.stringify(this.transformFlowData(o));Object(p["l"])({project_id:this.project_id,flow_id:this.flow_id,status:i}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.flowActions(),t.flowStatus())}))}else this.$message({message:"请添加状态",type:"warning"})},flowChartMod:function(){var t=this,e=this.graph.toJSON(),o=JSON.stringify(e);this.flowData=o;var i=JSON.stringify(this.transformFlowData(o)),n=JSON.stringify(this.extractNodeRelationships(o));Object(p["g"])({flow_id:this.flow_id,chart:this.flowData,status:i,actions:n}).then((function(e){0==e.code&&t.$message({message:"保存流程成功",type:"success"})}))},exportData:function(){var t=this.graph.toJSON(),e=JSON.stringify(t,null,2);this.importDataJson=e},confirmImport:function(){try{var t=JSON.parse(this.flowData);this.graph.fromJSON(t),this.updateLists(),this.importModalVisible=!1,this.importDataJson=""}catch(e){}},exportHighQualitySVG:function(){if(!this.graph)return null;var t=this.graph.container,e=this.graph.getContentBBox()||{x:0,y:0,width:t.clientWidth,height:t.clientHeight},o=20,i=e.width+2*o,n=e.height+2*o;this.graph.toSVG((function(t){console.log(t)}),{preserveDimensions:{width:i,height:n},viewBox:{x:e.x-o,y:e.y-o,width:i,height:n},copyStyles:!0,stylesheet:"\n          .x6-node rect, .x6-node circle {\n            vector-effect: non-scaling-stroke;\n          }\n          .x6-edge path {\n            vector-effect: non-scaling-stroke;\n          }\n        ",beforeSerialize:function(t){return t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t}})},copySVGToClipboard:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.exportHighQualitySVG(),e){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,navigator.clipboard.writeText(e);case 6:alert("SVG代码已复制到剪贴板！"),t.next=18;break;case 9:t.prev=9,t.t0=t["catch"](3),o=document.createElement("textarea"),o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select();try{document.execCommand("copy"),alert("SVG代码已复制到剪贴板！")}catch(i){alert("复制失败，请手动复制控制台输出的代码"),console.log("SVG代码:",e)}finally{document.body.removeChild(o)}case 18:case"end":return t.stop()}}),t,this,[[3,9]])})));function e(){return t.apply(this,arguments)}return e}(),initGraph:function(){var t=this,e=this;this.graph=new m["b"]({container:this.$refs.container,width:"100%",height:"100%",grid:{size:10,visible:!0},background:{color:"#fafafa"},panning:{enabled:!0,eventTypes:["leftMouseDown"]},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:["ctrl","meta"]},connecting:{router:"manhattan",connector:"rounded",anchor:"center",connectionPoint:"boundary",allowBlank:!1,snap:{radius:20},createEdge:function(){return new m["c"].Edge({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},labels:[{position:.5,attrs:{text:{text:""}}}],zIndex:0})},validateConnection:function(t){var e=t.targetMagnet;return!!e}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}}),console.log(this.nodesRegistered),this.nodesRegistered||(m["b"].registerNode("custom-rect",{inherit:"rect",width:140,height:60,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"rgba(24, 144, 255, 0.1)",rx:6,ry:6},label:{text:"",refX:.5,refY:.3,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.7,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(t){var o=t.data,i=f(t,["data"]);return o?Object(h["a"])({},i,{attrs:{label:{text:o.label||"节点"},content:{text:o.content||""},body:{fill:e.hexToRgba(o.color||"#1890ff",.1),stroke:o.color||"#1890ff"}},data:o}):t},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),m["b"].registerNode("custom-circle",{inherit:"circle",width:80,height:80,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"rgba(24, 144, 255, 0.1)",refCx:"50%",refCy:"50%",refR:"50%"},label:{text:"",refX:.5,refY:.4,fontSize:12,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.6,fontSize:10,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(t){var o=t.data,i=f(t,["data"]);return o?Object(h["a"])({},i,{attrs:{label:{text:o.label||"节点"},content:{text:o.content||""},body:{fill:e.hexToRgba(o.color||"#1890ff",.1),stroke:o.color||"#1890ff"}},data:o}):t},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),m["b"].registerNode("custom-round-rect",{inherit:"rect",width:140,height:60,attrs:{body:{strokeWidth:1,stroke:"#13C2C2",fill:"rgba(19, 194, 194, 0.1)",rx:16,ry:16},label:{text:"",refX:.5,refY:.3,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.7,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(e){var o=e.data,i=f(e,["data"]);if(o){var n=t;return Object(h["a"])({},i,{attrs:{label:{text:o.label||"圆角矩形"},content:{text:o.content||"过程"},body:{fill:n.hexToRgba(o.color||"#13C2C2",.1),stroke:o.color||"#13C2C2"}},data:o})}return e},ports:{groups:{top:{position:"top",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),m["b"].registerNode("custom-diamond",{inherit:"polygon",width:100,height:100,attrs:{body:{refPoints:"0,50 50,0 100,50 50,100",strokeWidth:1,stroke:"#722ED1",fill:"rgba(114, 46, 209, 0.1)",strokeDasharray:""},label:{text:"",refX:.5,refY:.4,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.6,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(e){var o=e.data,i=f(e,["data"]);if(o){var n=t;return Object(h["a"])({},i,{attrs:{label:{text:o.label||"菱形节点"},content:{text:o.content||"判断"},body:{fill:n.hexToRgba(o.color||"#722ED1",.1),stroke:o.color||"#722ED1"}},data:o})}return e},ports:{groups:{top:{position:{name:"absolute",args:{x:50,y:0}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:{name:"absolute",args:{x:100,y:50}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:{name:"absolute",args:{x:50,y:100}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:{name:"absolute",args:{x:0,y:50}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),this.$store.dispatch("user/_setNodesRegistered",!0)),this.graph.enableRubberband(),this.graph.enableKeyboard(),this.graph.on("node:mouseenter",(function(e){var o=e.node,i=t.graph.container.querySelectorAll(".x6-port-body");i.forEach((function(t){t.style.visibility="visible"})),o.addTools({name:"button-remove",args:{onClick:function(e){var o=e.view,i=o.cell;i&&i.isNode()&&t.deleteNodeWithConfirmation(i.id)}}})})),this.graph.on("node:mouseleave",(function(e){var o=e.node,i=t.graph.container.querySelectorAll(".x6-port-body");i.forEach((function(t){t.style.visibility="hidden"})),o.removeTools()})),this.graph.on("edge:mouseenter",(function(e){var o=e.edge;o.addTools([{name:"button-remove",args:{distance:"70%",markup:[{tagName:"circle",selector:"button",attrs:{r:8,fill:"#ff4d4f",stroke:"#fff","stroke-width":2,cursor:"pointer"}}],onClick:function(e){var o=e.view;console.log(o,123456),t.$confirm("确定删除这条连接线吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=o.cell;e&&e.isEdge()&&(t.graph.removeEdge(e),t.updateLists())}))}}}])})),this.graph.on("edge:mouseleave",(function(t){var e=t.edge;e.removeTools()})),this.graph.on("node:dblclick",(function(e){var o=e.node;t.editNode(o.id)})),this.graph.use(new m["a"]),this.zoom=this.graph.zoom(),this.confirmImport()},deleteNodeWithConfirmation:function(t){var e=this;console.log(t);var o=this.graph.getCellById(t);if(o){var i="未命名节点",n=o.getData(),a=o.attr("label/text");n&&n.label?i=n.label:a&&(i=a);var r=this.graph.getConnectedEdges(o),s=r?r.length:0,l='确定要删除节点 "'.concat(i,'" 吗？');s>0&&(l='确定要删除节点 "'.concat(i,'" 吗？\n该节点有 ').concat(s," 条连接线，将同时被删除。")),this.$confirm(l,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r&&r.length>0&&r.forEach((function(t){t&&e.graph.removeEdge(t)})),e.graph.removeCell(o),e.updateLists()}))}},editNode:function(t){var e=this.graph.getCellById(t);if(e){var o=e.getData()||{};this.editingNodeId=t,this.editingNodeData={label:o.label||e.attr("label/text")||"未命名节点",content:o.content||e.attr("content/text")||"",color:o.color||"#1890ff",type:o.type},this.editModalVisible=!0}},saveNodeContent:function(){var t=this;this.$refs["editingNodeForm"].validate((function(e){if(e&&t.editingNodeId){var o=t.graph.getCellById(t.editingNodeId);o&&(o.setData(t.editingNodeData),o.attr("label/text",t.editingNodeData.label),o.attr("content/text",t.editingNodeData.content),o.attr("body/fill",t.hexToRgba(t.editingNodeData.color,.1)),o.attr("body/stroke",t.editingNodeData.color),t.updateLists()),t.editModalVisible=!1,t.editingNodeId=null}}))},cancelEdit:function(){this.$refs["editingNodeForm"].clearValidate(),this.editModalVisible=!1,this.editingNodeId=null},addRectNode:function(t){var e=100+400*Math.random(),o=100+300*Math.random(),i="rect-node-".concat(Date.now()),n=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"],a=(n[Math.floor(Math.random()*n.length)],null);if("start"==t){console.log(this.nodes);var r=this.nodes.findIndex((function(e){return e.type==t}));if(-1!=r)return void this.$message({message:"只能添加一个开始节点",type:"error"});a={label:"开始节点".concat(this.nodes.length+1),content:"开始节点描述",color:"#307dee",type:t}}else"process"==t?a={label:"过程节点".concat(this.nodes.length+1),content:"过程节点描述",color:"#289947",type:t}:"end"==t&&(a={label:"结束节点".concat(this.nodes.length+1),content:"结束节点描述",color:"#e53d30",type:t});this.graph.addNode({id:i,shape:"custom-rect",x:e,y:o,data:a}),this.updateLists()},addCircleNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="circle-node-".concat(Date.now()),i=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-circle",x:t,y:e,data:{label:"圆形节点".concat(this.nodes.length+1),content:"测试",color:n}}),this.updateLists()},addDiamondNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="diamond-node-".concat(Date.now()),i=["#722ED1","#1890ff","#52c41a","#faad14","#f5222d","#13C2C2"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-diamond",x:t,y:e,data:{label:"菱形节点".concat(this.nodes.length+1),content:"判断",color:n}}),this.updateLists()},addRoundRectNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="round-rect-node-".concat(Date.now()),i=["#13C2C2","#1890ff","#52c41a","#faad14","#f5222d","#722ED1"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-round-rect",x:t,y:e,data:{label:"圆角矩形节点".concat(this.nodes.length+1),content:"过程",color:n}}),this.updateLists()},updateLists:function(){var t=this.graph.getCells();this.nodes=t.filter((function(t){return t.isNode()})).map((function(t){var e=t.getData()||{},o=t.attr("label/text");return{id:t.id,label:e.label||o||"节点".concat(t.id.substring(0,4)),content:e.content||t.attr("content/text")||"",color:e.color||"#1890ff",shape:t.shape,type:e.type}})),this.edges=t.filter((function(t){return t.isEdge()})),console.log(this.nodes,this.cells)},hexToRgba:function(t,e){if(!t)return"rgba(24, 144, 255, ".concat(e,")");4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var o=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);return"rgba(".concat(o,", ").concat(i,", ").concat(n,", ").concat(e,")")},flowInfo:function(){var t=this;Object(p["i"])({flow_id:this.flow_id}).then((function(e){t.baseInfoData.name=e.data.name,t.baseInfoData.intro=e.data.intro,t.flowData=e.data.chart,t.confirmImport()}))},sumbitFlowInfo:function(){var t=this;Object(p["d"])({flow_id:this.flow_id,actions:JSON.stringify(this.flowList)}).then((function(e){0==e.code&&t.$message({message:"保存流程成功",type:"success"})}))},flowActions:function(){var t=this;Object(p["e"])({flow_id:this.flow_id}).then((function(e){console.log(e),t.flowList=e.data}))},handleFlow:function(t,e){var o=this.flowList[t].dst_status.indexOf(e);this.flowList[t].dst_status=-1!==o?[].concat(Object(a["a"])(this.flowList[t].dst_status.slice(0,o)),Object(a["a"])(this.flowList[t].dst_status.slice(o+1))):[].concat(Object(a["a"])(this.flowList[t].dst_status),[e])},handleBegin:function(t){this.statusList.map((function(e,o){e.is_begin=t==o?1:0}))},handleEnd:function(t){this.statusList[t].is_end=1==this.statusList[t].is_end?0:1,console.log(this.statusList)},flowStatus:function(){var t=this;Object(p["k"])({flow_id:this.flow_id}).then((function(e){0==e.code&&(t.statusList=e.data?e.data:[])}))},submitStatusInfo:function(){var t=this;0!=this.statusList.length?Object(p["l"])({project_id:this.project_id,flow_id:this.flow_id,status:JSON.stringify(this.statusList)}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.activeName="flowSet",t.flowActions())})):this.$message({message:"请添加状态",type:"warning"})},closedDialog:function(){this.$refs["statusForm"].clearValidate(),this.statusForm={name:"",intro:"",is_begin:0,is_end:0},this.formType="add"},submitStatus:function(){var t=this;this.$refs["statusForm"].validate((function(e){e&&("mod"==t.formType?(t.$set(t.statusList,t.activeStatusIndex,t.statusForm),t.statusDialog=!1):(t.statusList.push(t.statusForm),t.statusDialog=!1))}))},addStatus:function(){this.formType="add",this.statusDialog=!0},delStatus:function(t){this.statusList.splice(t,1)},editSatus:function(t,e){this.activeStatusIndex=e,this.statusForm.name=t.name,this.statusForm.intro=t.intro,this.statusForm.is_begin=t.is_begin,this.statusForm.is_end=t.is_end,this.formType="mod",this.statusDialog=!0},baseInfoMod:function(){this.baseInfoForm.name=this.baseInfoData.name,this.baseInfoForm.intro=this.baseInfoData.intro,this.baseInfoDialog=!0},closedBaseInfoDialog:function(){this.$refs["baseInfoForm"].clearValidate(),this.baseInfoForm.name="",this.baseInfoForm.intro="",this.baseInfoDialog=!1},submitBaseInfo:function(){var t=this;this.$refs["baseInfoForm"].validate((function(e){if(e){var o={};o.flow_id=t.flow_id,o.project_id=t.project_id,o.name=t.baseInfoForm.name,o.intro=t.baseInfoForm.intro,Object(p["j"])(o).then((function(e){t.$message({message:"修改成功",type:"success"}),t.baseInfoData.name=t.baseInfoForm.name,t.baseInfoData.intro=t.baseInfoForm.intro,t.closedBaseInfoDialog()}))}}))},back:function(){this.$router.go(-1)},changeTab:function(t){var e=this;"flowSet"==t.name&&this.flowActions(),"flow"!=t.name||this.graph||Object(g["setTimeout"])((function(){e.initGraph()}),0)}}},y=v,w=(o("8cf4"),o("2877")),x=Object(w["a"])(y,i,n,!1,null,"7814cdb2",null);e["default"]=x.exports},"20d6":function(t,e,o){"use strict";var i=o("5ca1"),n=o("0a49")(6),a="findIndex",r=!0;a in[]&&Array(1)[a]((function(){r=!1})),i(i.P+i.F*r,"Array",{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),o("9c6c")(a)},"24d2":function(t,e,o){"use strict";o.d(e,"g",(function(){return a})),o.d(e,"m",(function(){return r})),o.d(e,"h",(function(){return s})),o.d(e,"f",(function(){return l})),o.d(e,"j",(function(){return c})),o.d(e,"i",(function(){return d})),o.d(e,"d",(function(){return f})),o.d(e,"e",(function(){return u})),o.d(e,"k",(function(){return h})),o.d(e,"l",(function(){return p})),o.d(e,"a",(function(){return m})),o.d(e,"c",(function(){return g})),o.d(e,"n",(function(){return b})),o.d(e,"b",(function(){return v}));var i=o("365c"),n={addProject:"add",editProject:"mod",getProjectList:"list",delProject:"del",flowStautsMod:"flowStautsMod",flowStatus:"flowStatus",flowActions:"flowActions",flowActionMod:"flowActionMod",flowInfo:"flowInfo",flowMod:"flowMod",flowAdd:"flowAdd",flowDel:"flowDel",flowList:"flowList",flowChartMod:"flowChartMod"};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowChartMod,t,"api/project")}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowList,t,"api/project")}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowDel,t,"api/project")}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowAdd,t,"api/project")}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowMod,t,"api/project")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowInfo,t,"api/project")}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowActionMod,t,"api/project")}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowActions,t,"api/project")}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowStatus,t,"api/project")}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowStautsMod,t,"api/project")}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.addProject,t,"api/project")}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.editProject,t,"api/project")}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.getProjectList,t,"api/project")}function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.delProject,t,"api/project")}},"2f21":function(t,e,o){"use strict";var i=o("79e5");t.exports=function(t,e){return!!t&&i((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},5118:function(t,e,o){(function(t){var i="undefined"!==typeof t&&t||"undefined"!==typeof self&&self||window,n=Function.prototype.apply;function a(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new a(n.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new a(n.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},o("6017"),e.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof t&&t.clearImmediate||this&&this.clearImmediate}).call(this,o("c8ba"))},"55dd":function(t,e,o){"use strict";var i=o("5ca1"),n=o("d8e8"),a=o("4bf8"),r=o("79e5"),s=[].sort,l=[1,2,3];i(i.P+i.F*(r((function(){l.sort(void 0)}))||!r((function(){l.sort(null)}))||!o("2f21")(s)),"Array",{sort:function(t){return void 0===t?s.call(a(this)):s.call(a(this),n(t))}})},6017:function(t,e,o){(function(t,e){(function(t,o){"use strict";if(!t.setImmediate){var i,n=1,a={},r=!1,s=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?h():p()?m():t.MessageChannel?g():s&&"onreadystatechange"in s.createElement("script")?b():v(),l.setImmediate=c,l.clearImmediate=d}function c(t){"function"!==typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),o=0;o<e.length;o++)e[o]=arguments[o+1];var r={callback:t,args:e};return a[n]=r,i(n),n++}function d(t){delete a[t]}function f(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(o,i);break}}function u(t){if(r)setTimeout(u,0,t);else{var e=a[t];if(e){r=!0;try{f(e)}finally{d(t),r=!1}}}}function h(){i=function(t){e.nextTick((function(){u(t)}))}}function p(){if(t.postMessage&&!t.importScripts){var e=!0,o=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=o,e}}function m(){var e="setImmediate$"+Math.random()+"$",o=function(o){o.source===t&&"string"===typeof o.data&&0===o.data.indexOf(e)&&u(+o.data.slice(e.length))};t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),i=function(o){t.postMessage(e+o,"*")}}function g(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;u(e)},i=function(e){t.port2.postMessage(e)}}function b(){var t=s.documentElement;i=function(e){var o=s.createElement("script");o.onreadystatechange=function(){u(e),o.onreadystatechange=null,t.removeChild(o),o=null},t.appendChild(o)}}function v(){i=function(t){setTimeout(u,0,t)}}})("undefined"===typeof self?"undefined"===typeof t?this:t:self)}).call(this,o("c8ba"),o("f28c"))},"8cf4":function(t,e,o){"use strict";var i=o("e611"),n=o.n(i);n.a},e611:function(t,e,o){}}]);