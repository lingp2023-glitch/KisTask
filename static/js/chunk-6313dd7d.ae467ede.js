(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6313dd7d"],{5132:function(t,e,s){"use strict";s.d(e,"e",(function(){return n})),s.d(e,"b",(function(){return l})),s.d(e,"g",(function(){return r})),s.d(e,"c",(function(){return o})),s.d(e,"f",(function(){return c})),s.d(e,"a",(function(){return u})),s.d(e,"d",(function(){return d}));var i=s("365c"),a={addIssue:"add",issueList:"list",queryWorker:"queryWorker",issueInfo:"info",submitIssue:"submit",actions:"actions",modIssue:"mod"};function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.modIssue,t,"api/issue")}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.actions,t,"api/issue")}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.submitIssue,t,"api/issue")}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.issueInfo,t,"api/issue")}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.queryWorker,t,"api/issue")}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.addIssue,t,"api/issue")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(a.issueList,t,"api/issue")}},"566c":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"className"},[s("el-card",{staticClass:"anoCard"},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("我的工作")])]),s("div",{staticClass:"searchDiv"},[s("div",{staticClass:"search-name"},[s("el-input",{attrs:{placeholder:"查询字符"},model:{value:t.searchData.query_str,callback:function(e){t.$set(t.searchData,"query_str",e)},expression:"searchData.query_str"}})],1),s("div",{staticClass:"search-btn"},[s("el-button",{attrs:{type:"success"},on:{click:t.getIssueList}},[t._v("搜索")])],1)]),s("div",[s("el-tabs",{on:{"tab-click":t.handleTabsClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"待办",name:"work"}}),s("el-tab-pane",{attrs:{label:"已办",name:"finish"}}),s("el-tab-pane",{attrs:{label:"已创建",name:"create"}})],1)],1),s("div",{staticClass:"box"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.issuesData.list,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266"}},on:{"cell-click":t.showIssuesDetail}},[s("el-table-column",{attrs:{prop:"title",label:"标题"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[s("el-tag",{attrs:{size:"mini",effect:"dark"}},[t._v("\n                "+t._s(e.row.flow_name)+"\n              ")]),t._v("\n              "+t._s(e.row.title)+"\n            ")],1)]}}])}),s("el-table-column",{attrs:{prop:"project_name",width:"150",label:"项目名称"}}),s("el-table-column",{attrs:{prop:"priority_name",width:"100",label:"优先级"}}),s("el-table-column",{attrs:{prop:"severity_name",width:"100",label:"严重程度"}}),s("el-table-column",{attrs:{prop:"status",width:"100",label:"状态"}}),s("el-table-column",{attrs:{prop:"workers",width:"150",label:"处理人"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",t._l(e.row.workers,(function(i,a){return s("span",{key:a},[t._v(t._s(a==e.row.workers.length-1?i.name:i.name+"、"))])})),0)]}}])}),s("el-table-column",{attrs:{prop:"creater_name",width:"150",label:"创建人"}}),s("el-table-column",{attrs:{prop:"create_time",width:"200",label:"创建时间"}})],1)],1),s("pagination",{attrs:{data:t.issuesData},on:{change:t.getIssueList}})],1),s("el-drawer",{attrs:{visible:t.showDetail,direction:"rtl",size:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.showDetail=e}}},[s("div",{staticClass:"issuesBox"},[s("div",{staticClass:"boxLeft"},[s("div",{staticClass:"headerBox"},[s("div",[s("div",{staticClass:"leftHeader"},[s("div",{staticClass:"statusBox activeStatus"},[t._v(t._s(t.issuesDetail.status))]),s("el-tag",{attrs:{size:"mini",effect:"dark"}},[t._v("\n                "+t._s(t.issuesDetail.flow_name)+"\n              ")]),s("div",{staticClass:"boxTitle"},[t._v("\n                "+t._s(t.issuesDetail.title)+"\n              ")])],1),s("div",{staticClass:"projectTitle"},[t._v("\n              "+t._s(t.issuesDetail.project_name)+"\n            ")])]),s("div",{staticClass:"controlHeader"},[s("el-button-group",[s("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left",disabled:!t.issuesDetail.prev_id},on:{click:function(e){return t.changeIssues(t.issuesDetail.prev_id)}}},[t._v("上一个")]),s("el-button",{attrs:{type:"primary",disabled:!t.issuesDetail.next_id},on:{click:function(e){return t.changeIssues(t.issuesDetail.next_id)}}},[t._v("下一个"),s("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.modIntro,expression:"!modIntro"}]},[s("div",{staticClass:"modBtn"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.openModHtml}},[t._v("编辑")])],1),s("div",{staticClass:"boxContent",domProps:{innerHTML:t._s(t.issuesDetail.content)},on:{click:t.handleImgClick}}),s("div",{staticClass:"subTitle"},[t._v("\n            评论\n          ")]),s("div",{staticClass:"actionsList"},[t._l(t.actionsData.list,(function(e,i){return s("div",{key:i,staticClass:"actionsItem"},[s("div",{staticClass:"itemHeader"},[s("span",{staticStyle:{"font-weight":"700"}},[t._v(t._s(e.work_name))]),e.bstatus?s("span",{staticClass:"status"},[t._v("\n                  流转状态从 ["+t._s(e.bstatus)+"] 到 ["+t._s(e.estatus)+"] 添加\n                ")]):s("span",{staticClass:"status"},[t._v("\n                  在状态 ["+t._s(e.estatus)+"] 添加\n                ")])]),s("div",{staticClass:"info",domProps:{innerHTML:t._s(e.content)}}),s("div",{staticClass:"date"},[t._v("\n                "+t._s(e.work_time)+"\n              ")])])})),s("pagination",{attrs:{data:t.actionsData},on:{change:t.getActions}})],2),s("div",{staticClass:"subTitle"},[t._v("\n            工作流\n          ")]),s("div",{staticClass:"statusGroup"},t._l(t.issuesDetail.dst_status,(function(e,i){return s("div",{key:i,staticClass:"statusBox",class:{activeStatus:t.issuesType==e},on:{click:function(s){return t.changeStatus(e)}}},[t._v(t._s(e))])})),0),s("div",{staticClass:"flowContent"},[s("el-form",{ref:"form",attrs:{model:t.form,"status-icon":"",rules:t.rules,"label-width":"auto"}},[s("el-form-item",{attrs:{label:"处理人",prop:"workers"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"搜索选择处理人","remote-method":t.queryWorker,loading:t.loadingWorker},on:{change:t.changWorker},model:{value:t.form.workers,callback:function(e){t.$set(t.form,"workers",e)},expression:"form.workers"}},t._l(t.workersList,(function(t){return s("el-option",{key:t.userid,attrs:{label:t.name,value:t.userid}})})),1)],1)],1),s("u-e",{ref:"quill",staticClass:"introClass",on:{senHtml:t.getHtml}})],1),s("div",{staticClass:"controlBtn"},[s("el-button",{attrs:{type:"primary"},on:{click:t.submitIssue}},[t._v("提 交")])],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.modIntro,expression:"modIntro"}]},[s("u-e",{ref:"modQuill",staticClass:"modIntroClass",on:{senHtml:t.getModHtml}}),s("div",{staticClass:"controlBtn"},[s("el-button",{on:{click:t.closeModHtml}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.sumbitModContent}},[t._v("提 交")])],1)],1)]),s("div",{staticClass:"boxRight"},[s("el-descriptions",{attrs:{title:"基础信息",column:1}},[s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"状态"}},[s("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v("\n              "+t._s(t.issuesDetail.status)+"\n            ")])],1),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"优先级"}},[t._v(t._s(t.issuesDetail.priority_name))]),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"严重程度"}},[t._v(t._s(t.issuesDetail.severity_name))]),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"处理人"}},t._l(t.issuesDetail.workers,(function(e,i){return s("span",{key:i},[t._v(t._s(i==t.issuesDetail.workers.length-1?e.name:e.name+"、"))])})),0),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"预计开始"}},[t._v(t._s(t.issuesDetail.btime))]),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"预计结束"}},[t._v(t._s(t.issuesDetail.etime))]),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"创建人"}},[t._v(t._s(t.issuesDetail.creater_name))]),s("el-descriptions-item",{attrs:{"label-class-name":"cellTitle",label:"创建时间"}},[t._v(t._s(t.issuesDetail.create_time))])],1)],1)])]),s("el-dialog",{attrs:{visible:t.dialogVisible,width:"80%",top:"30px","custom-class":"img-dialog"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.closeDialog}},[s("div",{staticClass:"img-container"},[s("img",{staticStyle:{"max-width":"100%","max-height":"80vh"},attrs:{src:t.currentImg,alt:""}})]),t.imgList.length>1?s("div",{staticClass:"img-nav"},[s("el-button",{attrs:{icon:"el-icon-arrow-left",circle:"",disabled:0===t.currentIndex},on:{click:t.prevImg}}),s("span",[t._v(t._s(t.currentIndex+1)+" / "+t._s(t.imgList.length))]),s("el-button",{attrs:{icon:"el-icon-arrow-right",circle:"",disabled:t.currentIndex===t.imgList.length-1},on:{click:t.nextImg}})],1):t._e()])],1)},a=[],n=s("bd86"),l=(s("7f7f"),s("5df3"),s("1c4c"),s("5132")),r=s("4632"),o=s("cf2d"),c={name:"user",components:{pagination:r["a"],UE:o["a"]},data:function(){return{activeName:"work",searchData:{query_str:""},issuesData:{},showDetail:!1,issuesDetail:{},issuesType:"",form:{workers:[],content:""},rules:{workers:[{required:!0,message:"搜索选择处理人",trigger:"blur"}]},loadingWorker:!1,workersList:[],actionsData:{},dialogVisible:!1,imgList:[],currentImg:"",currentIndex:0,htmlTest:'<p><img src="https://th.bing.com/th/id/R.8bbf769b39bb26eefb9b6de51c23851d?rik=crTnc5i8A%2b8p7A&riu=http%3a%2f%2fpicview.iituku.com%2fcontentm%2fzhuanji%2fimg%2f202207%2f09%2fe7196ac159f7cf2b.jpg%2fnu&ehk=DYPLVpoNAXLj5qzwgR5vHf9DladFh%2b34s4UcuP3Kn6E%3d&risl=&pid=ImgRaw&r=0" class="" data-size="720,1612" style="width: 181px;"> <img src="https://th.bing.com/th/id/R.a527b360fe317d1ed2d80a49d51c9c1c?rik=SQr3Q9XFQzrf0A&riu=http%3a%2f%2fseopic.699pic.com%2fphoto%2f50075%2f6521.jpg_wh1200.jpg&ehk=7cbm1dF83MThf5g4EdvNfSIBgLkHs0931e6bQnc7sug%3d&risl=&pid=ImgRaw&r=0" class="" data-size="720,1612" style="width: 182px;"></p>',modIntro:!1,modContent:""}},filters:{},computed:{page:function(){return this.issuesData.page}},created:function(){this.getIssueList()},methods:Object(n["a"])({handleImgClick:function(t){if("IMG"===t.target.tagName){var e=this.$el.querySelectorAll(".boxContent img"),s=Array.from(e);this.imgList=s.map((function(t){return t.src})),this.currentIndex=s.indexOf(t.target),this.currentImg=this.imgList[this.currentIndex],this.dialogVisible=!0}},prevImg:function(){this.currentIndex>0&&(this.currentIndex--,this.currentImg=this.imgList[this.currentIndex])},nextImg:function(){this.currentIndex<this.imgList.length-1&&(this.currentIndex++,this.currentImg=this.imgList[this.currentIndex])},closeDialog:function(){this.dialogVisible=!1,this.imgList=[],this.currentIndex=0},submitIssue:function(){var t=this;this.$refs["form"].validate((function(e){if(e){var s={};s.issue_id=t.issuesDetail.issue_id,s.workers=JSON.stringify(t.form.workers),s.status=t.issuesType,s.content=t.form.content,Object(l["g"])(s).then((function(e){0==e.code&&(t.$message({message:"提交成功",type:"success"}),t.handleClose())}))}}))},changWorker:function(){this.$refs["form"].validateField("workers")},queryWorker:function(t){var e=this;this.loading=!0,Object(l["f"])({query_str:t,project_id:this.issuesDetail.project_id}).then((function(t){0==t.code&&(e.workersList=t.data)}))},getHtml:function(t){this.form.content=t},sumbitModContent:function(){var t=this;console.log(this.modContent),Object(l["e"])({issue_id:this.issuesDetail.issue_id,content:this.modContent}).then((function(e){0==e.code&&(t.$message({message:"修改成功",duration:1e3,type:"success"}),Object(l["c"])({issue_id:t.issuesDetail.issue_id}).then((function(e){t.issuesDetail=e.data})),t.closeModHtml())}))},openModHtml:function(){this.$refs.modQuill.setContent(this.issuesDetail.content),this.modIntro=!0},getModHtml:function(t){this.modContent=t},closeModHtml:function(){this.$refs.modQuill.setContent(""),this.modIntro=!1},changeStatus:function(t){this.issuesType=t},changeIssues:function(t){var e=this;Object(l["c"])({issue_id:t}).then((function(t){e.issuesDetail=t.data,e.issuesType=e.issuesDetail.dst_status[0],e.showDetail=!0,e.getActions(),e.queryWorker()}))},showIssuesDetail:function(t){var e=this;console.log(t),Object(l["c"])({issue_id:t.issue_id}).then((function(t){e.issuesDetail=t.data,e.issuesType=e.issuesDetail.dst_status[0],e.showDetail=!0,e.getActions(),e.queryWorker()}))},getActions:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(l["b"])({issue_id:this.issuesDetail.issue_id,page:e}).then((function(e){t.actionsData=e.data}))},handleClose:function(){this.$refs["form"].clearValidate(),this.form={workers:[],content:""},this.$refs.quill.setContent(""),this.showDetail=!1,this.closeModHtml()},handleTabsClick:function(t){console.log(t.name),this.activeName=t.name,this.getIssueList()},getIssueList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=this.searchData.query_str;Object(l["d"])({page:e,query_str:s,query_code:this.activeName}).then((function(e){0==e.code&&(t.issuesData=e.data)}))}},"changWorker",(function(){this.$refs["form"].validateField("workers")}))},u=c,d=(s("ccac"),s("2877")),m=Object(d["a"])(u,i,a,!1,null,null,null);e["default"]=m.exports},"58c6":function(t,e,s){},ccac:function(t,e,s){"use strict";var i=s("58c6"),a=s.n(i);a.a}}]);