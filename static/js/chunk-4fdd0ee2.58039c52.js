(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4fdd0ee2"],{"0c9bf":function(t,e,o){},"0fb5":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"className"},[o("el-card",[o("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n      编辑工作流\n    ")]),o("div",{staticClass:"box"},[o("el-tabs",{on:{"tab-click":t.changeTab},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"基本信息",name:"baseInfo"}},[o("div",{staticClass:"formClass"},[o("el-form",{ref:"baseInfoForm",attrs:{model:t.baseInfoForm,"status-icon":"","label-width":"auto",rules:t.rules}},[o("el-form-item",{attrs:{label:"工作流名称",prop:"name"}},[o("el-input",{staticStyle:{width:"20vw"},attrs:{type:"text",autocomplete:"off"},model:{value:t.baseInfoForm.name,callback:function(e){t.$set(t.baseInfoForm,"name",e)},expression:"baseInfoForm.name"}})],1),o("el-form-item",{attrs:{label:"工作流说明",prop:"intro"}},[o("el-input",{staticStyle:{width:"20vw"},attrs:{type:"textarea",autocomplete:"off"},model:{value:t.baseInfoForm.intro,callback:function(e){t.$set(t.baseInfoForm,"intro",e)},expression:"baseInfoForm.intro"}})],1)],1),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.submitBaseInfo}},[t._v("保存&下一步")]),o("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1)]),o("el-tab-pane",{attrs:{label:"流程图",name:"flow"}},[o("div",{staticClass:"formBox"},[o("div",{staticClass:"boxLeft"},[o("div",{ref:"container",staticStyle:{height:"75vh"}})]),o("div",{staticClass:"boxRight"},[o("button",{on:{click:function(e){return t.addRectNode("start")}}},[t._v("添加起始")]),o("button",{on:{click:function(e){return t.addRectNode("process")}}},[t._v("添加过程")]),o("button",{on:{click:function(e){return t.addRectNode("end")}}},[t._v("添加结束")]),o("button",{on:{click:t.exportData}},[t._v("导出数据")]),o("button",{on:{click:t.confirmImport}},[t._v("导入数据")]),o("button",{on:{click:t.toggleConnecting}},[t._v("\n                "+t._s(t.connectingEnabled?"关闭连线":"开启连线")+"\n              ")]),o("button",{on:{click:t.flowSaveStatus}},[t._v("保存状态")]),o("button",{on:{click:t.flowSaveFlow}},[t._v("保存流程")]),o("div",{staticStyle:{height:"60%","overflow-y":"scroll"}},[t._v("\n                "+t._s(t.importDataJson)+"\n              ")])])]),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"}},[t._v("保存&下一步")]),o("el-button",{on:{click:t.back}},[t._v("取消")])],1)]),o("el-tab-pane",{attrs:{label:"状态定义",name:"statusSet"}},[o("div",{staticClass:"searchDiv"},[o("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addStatus}},[t._v("添加状态")])],1),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.statusList,border:""}},[o("el-table-column",{attrs:{prop:"name",label:"状态名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tag",[t._v(t._s(e.row.name))])]}}])}),o("el-table-column",{attrs:{prop:"intro",label:"状态说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.intro?e.row.intro:"-")+"\n              ")]}}])}),o("el-table-column",{attrs:{prop:"name",label:"起始状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"radio",name:"begin",value:"1"},domProps:{checked:1==e.row.is_begin},on:{click:function(o){return t.handleBegin(e.$index)}}})]}}])}),o("el-table-column",{attrs:{prop:"name",label:"结束状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("input",{attrs:{type:"checkbox",name:"end",value:"1"},domProps:{checked:1==e.row.is_end},on:{click:function(o){return t.handleEnd(e.$index)}}})]}}])}),o("el-table-column",{attrs:{prop:"create_time",label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.editSatus(e.row,e.$index)}}},[t._v("编辑")]),o("el-popconfirm",{attrs:{title:"你确定要删除吗？",confirmButtonType:"danger"},on:{confirm:function(o){return t.delStatus(e.$index)}}},[o("el-button",{staticStyle:{"margin-left":"8px"},attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.submitStatusInfo}},[t._v("保存&下一步")]),o("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1),o("el-tab-pane",{attrs:{label:"流转设置",name:"flowSet"}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.flowList,border:"","max-height":"65vh"}},[o("el-table-column",{attrs:{fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                从【"+t._s(e.row.src_status)+"】中可流转到\n              ")]}}])}),t._l(t.flowList,(function(e,i){return o("el-table-column",{key:i,attrs:{label:e.src_status},scopedSlots:t._u([{key:"default",fn:function(i){return[o("input",{attrs:{type:"checkbox"},domProps:{checked:i.row.dst_status.includes(e.src_status)},on:{click:function(o){return t.handleFlow(i.$index,e.src_status)}}})]}}],null,!0)})}))],2),o("div",{staticClass:"chitrolBtn"},[o("el-button",{attrs:{type:"primary"},on:{click:t.sumbitFlowInfo}},[t._v("保存")])],1)],1)],1)],1)]),o("el-dialog",{attrs:{width:"30vw",title:"mod"==t.formType?"修改状态":"新增状态",visible:t.statusDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.statusDialog=e},closed:t.closedDialog}},[o("el-form",{ref:"statusForm",attrs:{"label-width":"auto",model:t.statusForm,rules:t.statusRules}},[o("el-form-item",{attrs:{label:"状态名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入状态名称"},model:{value:t.statusForm.name,callback:function(e){t.$set(t.statusForm,"name",e)},expression:"statusForm.name"}})],1),o("el-form-item",{attrs:{label:"状态说明",prop:"intro"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入状态说明"},model:{value:t.statusForm.intro,callback:function(e){t.$set(t.statusForm,"intro",e)},expression:"statusForm.intro"}})],1)],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.statusDialog=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.submitStatus}},[t._v("确 定")])],1)],1)],1)},n=[],r=o("75fc"),s=(o("7f7f"),o("20d6"),o("a8db")),a=(o("96cf"),o("3b8d")),l=(o("55dd"),o("ac6a"),o("cebc")),c=o("24d2"),d=o("5728"),f=o("5118"),u=o("2f62"),h={data:function(){return{type:"add",project_id:"",flow_id:"",activeName:"baseInfo",baseInfoForm:{name:"",intro:""},rules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},statusList:[],selectedOption:"",formType:"add",statusDialog:!1,statusForm:{name:"",intro:"",is_begin:0,is_end:0},statusRules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},activeStatusIndex:null,flowList:[],graph:null,nodes:[],edges:[],selectedNodeId:null,editModalVisible:!1,importModalVisible:!1,zoom:1,editingNodeId:null,importDataJson:"",editingNodeData:{label:"",content:"",color:"#1890ff"},textData:'{ "cells": [ { "shape": "edge", "attrs": { "line": { "stroke": "#A2B1C3", "targetMarker": { "name": "block", "width": 12, "height": 8 } } }, "id": "27b410f1-13a8-44b7-ac87-ea77f7306e91", "labels": [ { "position": 0.5, "attrs": { "text": { "text": "" } } } ], "zIndex": 0, "source": { "cell": "rect-node-1767065246542", "port": "right-port" }, "target": { "cell": "rect-node-1767065247301", "port": "top-port" } }, { "shape": "edge", "attrs": { "line": { "stroke": "#A2B1C3", "targetMarker": { "name": "block", "width": 12, "height": 8 } } }, "id": "99ffd4e6-6471-418f-ac56-fd92dc94d3d0", "labels": [ { "position": 0.5, "attrs": { "text": { "text": "" } } } ], "zIndex": 0, "source": { "cell": "rect-node-1767065247301", "port": "right-port" }, "target": { "cell": "rect-node-1767065255917", "port": "top-port" } }, { "shape": "edge", "attrs": { "line": { "stroke": "#A2B1C3", "targetMarker": { "name": "block", "width": 12, "height": 8 } } }, "id": "61cb77f4-dee9-43ee-9945-cd8eb7e04aaf", "labels": [ { "position": 0.5, "attrs": { "text": { "text": "" } } } ], "zIndex": 0, "source": { "cell": "rect-node-1767065246542", "port": "bottom-port" }, "target": { "cell": "rect-node-1767065255917", "port": "bottom-port" } }, { "position": { "x": 103.4502816186473, "y": 187.1064756719067 }, "size": { "width": 140, "height": 60 }, "attrs": { "body": { "stroke": "#307dee", "fill": "rgba(48, 125, 238, 0.1)" }, "label": { "text": "开始节点" }, "content": { "text": "开始节点描述" } }, "visible": true, "shape": "custom-rect", "ports": { "groups": { "top": { "position": "top", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "right": { "position": "right", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "bottom": { "position": "bottom", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "left": { "position": "left", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } } }, "items": [ { "group": "top", "id": "top-port" }, { "group": "right", "id": "right-port" }, { "group": "bottom", "id": "bottom-port" }, { "group": "left", "id": "left-port" } ] }, "id": "rect-node-1767065246542", "type": "start", "data": { "label": "开始节点", "content": "开始节点描述", "color": "#307dee" }, "zIndex": 1 }, { "position": { "x": 340, "y": 210 }, "size": { "width": 140, "height": 60 }, "attrs": { "body": { "stroke": "#289947", "fill": "rgba(40, 153, 71, 0.1)" }, "label": { "text": "过程节点" }, "content": { "text": "过程节点描述" } }, "visible": true, "shape": "custom-rect", "ports": { "groups": { "top": { "position": "top", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "right": { "position": "right", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "bottom": { "position": "bottom", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "left": { "position": "left", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } } }, "items": [ { "group": "top", "id": "top-port" }, { "group": "right", "id": "right-port" }, { "group": "bottom", "id": "bottom-port" }, { "group": "left", "id": "left-port" } ] }, "id": "rect-node-1767065247301", "type": "process", "data": { "label": "过程节点", "content": "过程节点描述", "color": "#289947" }, "zIndex": 2 }, { "position": { "x": 610, "y": 250 }, "size": { "width": 140, "height": 60 }, "attrs": { "body": { "stroke": "#e53d30", "fill": "rgba(229, 61, 48, 0.1)" }, "label": { "text": "结束节点" }, "content": { "text": "结束节点描述" } }, "visible": true, "shape": "custom-rect", "ports": { "groups": { "top": { "position": "top", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "right": { "position": "right", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "bottom": { "position": "bottom", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } }, "left": { "position": "left", "attrs": { "circle": { "r": 4, "magnet": true, "stroke": "#5F95FF", "strokeWidth": 1, "fill": "#fff", "style": { "visibility": "hidden" } } } } }, "items": [ { "group": "top", "id": "top-port" }, { "group": "right", "id": "right-port" }, { "group": "bottom", "id": "bottom-port" }, { "group": "left", "id": "left-port" } ] }, "id": "rect-node-1767065255917", "type": "end", "data": { "label": "结束节点", "content": "结束节点描述", "color": "#e53d30" }, "zIndex": 3 } ] }',connectingEnabled:!0}},components:{},filters:{},created:function(){this.project_id=this.$route.params.project_id,this.flow_id=this.$route.params.flow_id,this.type=this.$route.params.type,"mod"==this.type&&(this.flowInfo(),this.flowStatus())},onLoad:function(t){},onShow:function(){},mounted:function(){},computed:Object(l["a"])({},Object(u["b"])(["nodesRegistered"])),beforeDestroy:function(){this.destroyGraph()},methods:{destroyGraph:function(){this.graph&&(this.graph.clearCells(),this.graph.dispose(),this.graph=null)},toggleConnecting:function(){var t=this;this.connectingEnabled=!this.connectingEnabled,this.connectingEnabled?this.graph.on("node:mouseenter",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="visible"}))})):this.graph.on("node:mouseenter",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="hidden"}))}))},extractNodeRelationships:function(t){for(var e="string"===typeof t?JSON.parse(t):t,o={},i=[],n=0;n<e.cells.length;n++){var r=e.cells[n];if("custom-rect"===r.shape){var s=r.id,a="";r.attrs&&r.attrs.label&&r.attrs.label.text?a=r.attrs.label.text:r.data&&r.data.label&&(a=r.data.label),o[s]=a}else"edge"===r.shape&&r.source&&r.source.cell&&r.target&&r.target.cell&&i.push({source:r.source.cell,target:r.target.cell})}var l={};for(var s in o)o.hasOwnProperty(s)&&(l[o[s]]=[]);for(var c=0;c<i.length;c++){var d=i[c],f=o[d.source],u=o[d.target];f&&u&&l[f].push(u)}var h=[];for(var a in l)l.hasOwnProperty(a)&&h.push({src_status:a,dst_status:l[a]});return h},flowSaveFlow:function(){var t=this;if(console.log(this.nodes.length),0!=this.nodes.length){var e=this.graph.toJSON(),o=JSON.stringify(e,null,2);this.importDataJson=o;var i=JSON.stringify(this.extractNodeRelationships(o));Object(c["d"])({flow_id:this.flow_id,actions:i}).then((function(e){0==e.code&&(t.$message({message:"保存流程成功",type:"success"}),t.flowActions())}))}else this.$message({message:"请添加状态",type:"warning"})},transformFlowData:function(t){var e="string"===typeof t?JSON.parse(t):t,o=e.cells.filter((function(t){return"custom-rect"===t.shape}));o.sort((function(t,e){return t.zIndex-e.zIndex}));var i=o.map((function(t){var e=t.data.type||"process",o=t.attrs||{},i=t.data||{};return{name:o.label&&o.label.text||i.label||"",intro:o.content&&o.content.text||i.content||"",is_begin:"start"===e?1:0,is_end:"end"===e?1:0}}));return i},flowSaveStatus:function(){var t=this;if(console.log(this.nodes.length),0!=this.nodes.length){var e=this.graph.toJSON(),o=JSON.stringify(e,null,2);this.importDataJson=o;var i=JSON.stringify(this.transformFlowData(o));Object(c["k"])({project_id:this.project_id,flow_id:this.flow_id,status:i}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.flowActions(),t.flowStatus())}))}else this.$message({message:"请添加状态",type:"warning"})},exportData:function(){var t=this.graph.toJSON(),e=JSON.stringify(t,null,2);this.importDataJson=e},confirmImport:function(){try{var t=JSON.parse(this.textData);this.graph.fromJSON(t),this.updateLists(),this.importModalVisible=!1,this.importDataJson=""}catch(e){}},exportHighQualitySVG:function(){if(!this.graph)return null;var t=this.graph.container,e=this.graph.getContentBBox()||{x:0,y:0,width:t.clientWidth,height:t.clientHeight},o=20,i=e.width+2*o,n=e.height+2*o;this.graph.toSVG((function(t){console.log(t)}),{preserveDimensions:{width:i,height:n},viewBox:{x:e.x-o,y:e.y-o,width:i,height:n},copyStyles:!0,stylesheet:"\n          .x6-node rect, .x6-node circle {\n            vector-effect: non-scaling-stroke;\n          }\n          .x6-edge path {\n            vector-effect: non-scaling-stroke;\n          }\n        ",beforeSerialize:function(t){return t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t}})},copySVGToClipboard:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.exportHighQualitySVG(),e){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,navigator.clipboard.writeText(e);case 6:alert("SVG代码已复制到剪贴板！"),t.next=18;break;case 9:t.prev=9,t.t0=t["catch"](3),o=document.createElement("textarea"),o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select();try{document.execCommand("copy"),alert("SVG代码已复制到剪贴板！")}catch(i){alert("复制失败，请手动复制控制台输出的代码"),console.log("SVG代码:",e)}finally{document.body.removeChild(o)}case 18:case"end":return t.stop()}}),t,this,[[3,9]])})));function e(){return t.apply(this,arguments)}return e}(),initGraph:function(){var t=this,e=this;this.graph=new d["b"]({container:this.$refs.container,width:"100%",height:"100%",grid:{size:10,visible:!0},background:{color:"#fafafa"},panning:{enabled:!0,eventTypes:["leftMouseDown"]},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:["ctrl","meta"]},connecting:{router:"manhattan",connector:"rounded",anchor:"center",connectionPoint:"boundary",allowBlank:!1,snap:{radius:20},createEdge:function(){return new d["c"].Edge({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},labels:[{position:.5,attrs:{text:{text:""}}}],zIndex:0})},validateConnection:function(t){var e=t.targetMagnet;return!!e}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}}),console.log(this.nodesRegistered),this.nodesRegistered||(d["b"].registerNode("custom-rect",{inherit:"rect",width:140,height:60,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"rgba(24, 144, 255, 0.1)",rx:6,ry:6},label:{text:"",refX:.5,refY:.3,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.7,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(t){var o=t.data,i=Object(s["a"])(t,["data"]);return o?Object(l["a"])({},i,{attrs:{label:{text:o.label||"节点"},content:{text:o.content||""},body:{fill:e.hexToRgba(o.color||"#1890ff",.1),stroke:o.color||"#1890ff"}},data:o}):t},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),d["b"].registerNode("custom-circle",{inherit:"circle",width:80,height:80,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"rgba(24, 144, 255, 0.1)",refCx:"50%",refCy:"50%",refR:"50%"},label:{text:"",refX:.5,refY:.4,fontSize:12,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.6,fontSize:10,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(t){var o=t.data,i=Object(s["a"])(t,["data"]);return o?Object(l["a"])({},i,{attrs:{label:{text:o.label||"节点"},content:{text:o.content||""},body:{fill:e.hexToRgba(o.color||"#1890ff",.1),stroke:o.color||"#1890ff"}},data:o}):t},ports:{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),d["b"].registerNode("custom-round-rect",{inherit:"rect",width:140,height:60,attrs:{body:{strokeWidth:1,stroke:"#13C2C2",fill:"rgba(19, 194, 194, 0.1)",rx:16,ry:16},label:{text:"",refX:.5,refY:.3,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.7,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(e){var o=e.data,i=Object(s["a"])(e,["data"]);if(o){var n=t;return Object(l["a"])({},i,{attrs:{label:{text:o.label||"圆角矩形"},content:{text:o.content||"过程"},body:{fill:n.hexToRgba(o.color||"#13C2C2",.1),stroke:o.color||"#13C2C2"}},data:o})}return e},ports:{groups:{top:{position:"top",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:5,magnet:!0,stroke:"#13C2C2",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),d["b"].registerNode("custom-diamond",{inherit:"polygon",width:100,height:100,attrs:{body:{refPoints:"0,50 50,0 100,50 50,100",strokeWidth:1,stroke:"#722ED1",fill:"rgba(114, 46, 209, 0.1)",strokeDasharray:""},label:{text:"",refX:.5,refY:.4,fontSize:14,fontWeight:"bold",fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},content:{text:"",refX:.5,refY:.6,fontSize:12,fill:"#595959",textAnchor:"middle",textVerticalAnchor:"middle"}},markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"},{tagName:"text",selector:"content"}],propHooks:function(e){var o=e.data,i=Object(s["a"])(e,["data"]);if(o){var n=t;return Object(l["a"])({},i,{attrs:{label:{text:o.label||"菱形节点"},content:{text:o.content||"判断"},body:{fill:n.hexToRgba(o.color||"#722ED1",.1),stroke:o.color||"#722ED1"}},data:o})}return e},ports:{groups:{top:{position:{name:"absolute",args:{x:50,y:0}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:{name:"absolute",args:{x:100,y:50}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:{name:"absolute",args:{x:50,y:100}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:{name:"absolute",args:{x:0,y:50}},attrs:{circle:{r:5,magnet:!0,stroke:"#722ED1",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top",id:"top-port"},{group:"right",id:"right-port"},{group:"bottom",id:"bottom-port"},{group:"left",id:"left-port"}]}}),this.$store.dispatch("user/_setNodesRegistered",!0)),this.graph.enableRubberband(),this.graph.enableKeyboard(),this.graph.on("node:mouseenter",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="visible"}))})),this.graph.on("node:mouseleave",(function(){var e=t.graph.container.querySelectorAll(".x6-port-body");e.forEach((function(t){t.style.visibility="hidden"}))})),this.graph.on("edge:mouseenter",(function(e){var o=e.edge;o.addTools([{name:"button-remove",args:{distance:"70%",markup:[{tagName:"circle",selector:"button",attrs:{r:8,fill:"#ff4d4f",stroke:"#fff","stroke-width":2,cursor:"pointer"}}],onClick:function(e){var o=e.view,i=o.cell;i&&i.isEdge()&&(t.graph.removeEdge(i),t.updateLists())}}}])})),this.graph.on("edge:mouseleave",(function(t){var e=t.edge;e.removeTools()})),this.graph.on("blank:click",(function(t){t.x,t.y,t.e})),this.graph.use(new d["a"]),this.zoom=this.graph.zoom()},addRectNode:function(t){var e=100+400*Math.random(),o=100+300*Math.random(),i="rect-node-".concat(Date.now()),n=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"],r=(n[Math.floor(Math.random()*n.length)],null);if("start"==t){console.log(this.nodes);var s=this.nodes.findIndex((function(e){return e.type==t}));if(-1!=s)return void this.$message({message:"只能添加一个开始节点",type:"error"});r={label:"开始节点".concat(this.nodes.length+1),content:"开始节点描述",color:"#307dee",type:t}}else"process"==t?r={label:"过程节点".concat(this.nodes.length+1),content:"过程节点描述",color:"#289947",type:t}:"end"==t&&(r={label:"结束节点".concat(this.nodes.length+1),content:"结束节点描述",color:"#e53d30",type:t});this.graph.addNode({id:i,shape:"custom-rect",x:e,y:o,data:r}),this.updateLists()},addCircleNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="circle-node-".concat(Date.now()),i=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-circle",x:t,y:e,data:{label:"圆形节点".concat(this.nodes.length+1),content:"测试",color:n}}),this.updateLists()},addDiamondNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="diamond-node-".concat(Date.now()),i=["#722ED1","#1890ff","#52c41a","#faad14","#f5222d","#13C2C2"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-diamond",x:t,y:e,data:{label:"菱形节点".concat(this.nodes.length+1),content:"判断",color:n}}),this.updateLists()},addRoundRectNode:function(){var t=100+400*Math.random(),e=100+300*Math.random(),o="round-rect-node-".concat(Date.now()),i=["#13C2C2","#1890ff","#52c41a","#faad14","#f5222d","#722ED1"],n=i[Math.floor(Math.random()*i.length)];this.graph.addNode({id:o,shape:"custom-round-rect",x:t,y:e,data:{label:"圆角矩形节点".concat(this.nodes.length+1),content:"过程",color:n}}),this.updateLists()},updateLists:function(){var t=this.graph.getCells();this.nodes=t.filter((function(t){return t.isNode()})).map((function(t){var e=t.getData()||{},o=t.attr("label/text");return{id:t.id,label:e.label||o||"节点".concat(t.id.substring(0,4)),content:e.content||t.attr("content/text")||"",color:e.color||"#1890ff",shape:t.shape,type:e.type}})),this.edges=t.filter((function(t){return t.isEdge()}))},hexToRgba:function(t,e){if(!t)return"rgba(24, 144, 255, ".concat(e,")");4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var o=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);return"rgba(".concat(o,", ").concat(i,", ").concat(n,", ").concat(e,")")},flowInfo:function(){var t=this;Object(c["h"])({flow_id:this.flow_id}).then((function(e){t.baseInfoForm.name=e.data.name,t.baseInfoForm.intro=e.data.intro}))},sumbitFlowInfo:function(){var t=this;Object(c["d"])({flow_id:this.flow_id,actions:JSON.stringify(this.flowList)}).then((function(e){0==e.code&&t.$message({message:"保存流程成功",type:"success"})}))},flowActions:function(){var t=this;Object(c["e"])({flow_id:this.flow_id}).then((function(e){console.log(e),t.flowList=e.data}))},handleFlow:function(t,e){var o=this.flowList[t].dst_status.indexOf(e);this.flowList[t].dst_status=-1!==o?[].concat(Object(r["a"])(this.flowList[t].dst_status.slice(0,o)),Object(r["a"])(this.flowList[t].dst_status.slice(o+1))):[].concat(Object(r["a"])(this.flowList[t].dst_status),[e])},handleBegin:function(t){this.statusList.map((function(e,o){e.is_begin=t==o?1:0}))},handleEnd:function(t){this.statusList[t].is_end=1==this.statusList[t].is_end?0:1,console.log(this.statusList)},flowStatus:function(){var t=this;Object(c["j"])({flow_id:this.flow_id}).then((function(e){0==e.code&&(t.statusList=e.data?e.data:[])}))},submitStatusInfo:function(){var t=this;0!=this.statusList.length?Object(c["k"])({project_id:this.project_id,flow_id:this.flow_id,status:JSON.stringify(this.statusList)}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.activeName="flowSet",t.flowActions())})):this.$message({message:"请添加状态",type:"warning"})},closedDialog:function(){this.$refs["statusForm"].clearValidate(),this.statusForm={name:"",intro:"",is_begin:0,is_end:0},this.formType="add"},submitStatus:function(){var t=this;this.$refs["statusForm"].validate((function(e){e&&("mod"==t.formType?(t.$set(t.statusList,t.activeStatusIndex,t.statusForm),t.statusDialog=!1):(t.statusList.push(t.statusForm),t.statusDialog=!1))}))},addStatus:function(){this.formType="add",this.statusDialog=!0},delStatus:function(t){this.statusList.splice(t,1)},editSatus:function(t,e){this.activeStatusIndex=e,this.statusForm.name=t.name,this.statusForm.intro=t.intro,this.statusForm.is_begin=t.is_begin,this.statusForm.is_end=t.is_end,this.formType="mod",this.statusDialog=!0},submitBaseInfo:function(){var t=this;this.$refs["baseInfoForm"].validate((function(e){if(e)if("mod"==t.type){var o={};o.flow_id=t.flow_id,o.project_id=t.project_id,o.name=t.baseInfoForm.name,o.intro=t.baseInfoForm.intro,Object(c["i"])(o).then((function(e){t.$message({message:"修改成功",type:"success"}),t.activeName="statusSet"}))}else{var i={};i.project_id=t.project_id,i.name=t.baseInfoForm.name,i.intro=t.baseInfoForm.intro,Object(c["f"])(i).then((function(e){t.$message({message:"新增成功",type:"success"}),t.flow_id=e.data.flow_id,t.activeName="statusSet"}))}}))},back:function(){this.$router.go(-1)},changeTab:function(t){var e=this;"flowSet"==t.name&&this.flowActions(),"flow"!=t.name||this.graph||Object(f["setTimeout"])((function(){e.initGraph()}),0)}}},p=h,m=(o("6a26"),o("2877")),g=Object(m["a"])(p,i,n,!1,null,"11484f6a",null);e["default"]=g.exports},"20d6":function(t,e,o){"use strict";var i=o("5ca1"),n=o("0a49")(6),r="findIndex",s=!0;r in[]&&Array(1)[r]((function(){s=!1})),i(i.P+i.F*s,"Array",{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),o("9c6c")(r)},"24d2":function(t,e,o){"use strict";o.d(e,"l",(function(){return r})),o.d(e,"g",(function(){return s})),o.d(e,"f",(function(){return a})),o.d(e,"i",(function(){return l})),o.d(e,"h",(function(){return c})),o.d(e,"d",(function(){return d})),o.d(e,"e",(function(){return f})),o.d(e,"j",(function(){return u})),o.d(e,"k",(function(){return h})),o.d(e,"a",(function(){return p})),o.d(e,"c",(function(){return m})),o.d(e,"m",(function(){return g})),o.d(e,"b",(function(){return b}));var i=o("365c"),n={addProject:"add",editProject:"mod",getProjectList:"list",delProject:"del",flowStautsMod:"flowStautsMod",flowStatus:"flowStatus",flowActions:"flowActions",flowActionMod:"flowActionMod",flowInfo:"flowInfo",flowMod:"flowMod",flowAdd:"flowAdd",flowDel:"flowDel",flowList:"flowList"};function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowList,t,"api/project")}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowDel,t,"api/project")}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowAdd,t,"api/project")}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowMod,t,"api/project")}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowInfo,t,"api/project")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowActionMod,t,"api/project")}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowActions,t,"api/project")}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowStatus,t,"api/project")}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.flowStautsMod,t,"api/project")}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.addProject,t,"api/project")}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.editProject,t,"api/project")}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.getProjectList,t,"api/project")}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post(n.delProject,t,"api/project")}},"2f21":function(t,e,o){"use strict";var i=o("79e5");t.exports=function(t,e){return!!t&&i((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},5118:function(t,e,o){(function(t){var i="undefined"!==typeof t&&t||"undefined"!==typeof self&&self||window,n=Function.prototype.apply;function r(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new r(n.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new r(n.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},o("6017"),e.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof t&&t.clearImmediate||this&&this.clearImmediate}).call(this,o("c8ba"))},"55dd":function(t,e,o){"use strict";var i=o("5ca1"),n=o("d8e8"),r=o("4bf8"),s=o("79e5"),a=[].sort,l=[1,2,3];i(i.P+i.F*(s((function(){l.sort(void 0)}))||!s((function(){l.sort(null)}))||!o("2f21")(a)),"Array",{sort:function(t){return void 0===t?a.call(r(this)):a.call(r(this),n(t))}})},6017:function(t,e,o){(function(t,e){(function(t,o){"use strict";if(!t.setImmediate){var i,n=1,r={},s=!1,a=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?h():p()?m():t.MessageChannel?g():a&&"onreadystatechange"in a.createElement("script")?b():v(),l.setImmediate=c,l.clearImmediate=d}function c(t){"function"!==typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),o=0;o<e.length;o++)e[o]=arguments[o+1];var s={callback:t,args:e};return r[n]=s,i(n),n++}function d(t){delete r[t]}function f(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(o,i);break}}function u(t){if(s)setTimeout(u,0,t);else{var e=r[t];if(e){s=!0;try{f(e)}finally{d(t),s=!1}}}}function h(){i=function(t){e.nextTick((function(){u(t)}))}}function p(){if(t.postMessage&&!t.importScripts){var e=!0,o=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=o,e}}function m(){var e="setImmediate$"+Math.random()+"$",o=function(o){o.source===t&&"string"===typeof o.data&&0===o.data.indexOf(e)&&u(+o.data.slice(e.length))};t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),i=function(o){t.postMessage(e+o,"*")}}function g(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;u(e)},i=function(e){t.port2.postMessage(e)}}function b(){var t=a.documentElement;i=function(e){var o=a.createElement("script");o.onreadystatechange=function(){u(e),o.onreadystatechange=null,t.removeChild(o),o=null},t.appendChild(o)}}function v(){i=function(t){setTimeout(u,0,t)}}})("undefined"===typeof self?"undefined"===typeof t?this:t:self)}).call(this,o("c8ba"),o("f28c"))},"6a26":function(t,e,o){"use strict";var i=o("0c9bf"),n=o.n(i);n.a},a8db:function(t,e,o){"use strict";var i=o("e265"),n=o.n(i),r=o("a4bb"),s=o.n(r);function a(t,e){if(null==t)return{};var o,i,n={},r=s()(t);for(i=0;i<r.length;i++)o=r[i],e.indexOf(o)>=0||(n[o]=t[o]);return n}function l(t,e){if(null==t)return{};var o,i,r=a(t,e);if(n.a){var s=n()(t);for(i=0;i<s.length;i++)o=s[i],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}o.d(e,"a",(function(){return l}))}}]);