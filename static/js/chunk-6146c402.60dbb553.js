(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6146c402"],{"0fb5":function(t,e,s){"use strict";s.r(e);var o,n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"className"},[s("el-card",[s("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n      编辑工作流\n    ")]),s("div",{staticClass:"box"},[s("el-tabs",{on:{"tab-click":t.changeTab},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"基本信息",name:"baseInfo"}},[s("div",{staticClass:"formClass"},[s("el-form",{ref:"baseInfoForm",staticClass:"demo-ruleForm",attrs:{model:t.baseInfoForm,"status-icon":"","label-width":"auto",rules:t.rules}},[s("el-form-item",{attrs:{label:"工作流名称",prop:"name"}},[s("el-input",{staticStyle:{width:"20vw"},attrs:{type:"text",autocomplete:"off"},model:{value:t.baseInfoForm.name,callback:function(e){t.$set(t.baseInfoForm,"name",e)},expression:"baseInfoForm.name"}})],1),s("el-form-item",{attrs:{label:"工作流说明",prop:"intro"}},[s("el-input",{staticStyle:{width:"20vw"},attrs:{type:"textarea",autocomplete:"off"},model:{value:t.baseInfoForm.intro,callback:function(e){t.$set(t.baseInfoForm,"intro",e)},expression:"baseInfoForm.intro"}})],1)],1),s("div",{staticClass:"chitrolBtn"},[s("el-button",{attrs:{type:"primary"},on:{click:t.submitBaseInfo}},[t._v("保存&下一步")]),s("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1)]),s("el-tab-pane",{attrs:{label:"状态定义",name:"statusSet"}},[s("div",{staticClass:"searchDiv"},[s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addStatus}},[t._v("添加状态")])],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.statusList,border:""}},[s("el-table-column",{attrs:{prop:"name",label:"状态名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tag",[t._v(t._s(e.row.name))])]}}])}),s("el-table-column",{attrs:{prop:"intro",label:"状态说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.intro?e.row.intro:"-")+"\n              ")]}}])}),s("el-table-column",{attrs:{prop:"name",label:"起始状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("input",{attrs:{type:"radio",name:"begin",value:"1"},domProps:{checked:1==e.row.is_begin},on:{click:function(s){return t.handleBegin(e.$index)}}})]}}])}),s("el-table-column",{attrs:{prop:"name",label:"结束状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("input",{attrs:{type:"checkbox",name:"end",value:"1"},domProps:{checked:1==e.row.is_end},on:{click:function(s){return t.handleEnd(e.$index)}}})]}}])}),s("el-table-column",{attrs:{prop:"create_time",label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.editSatus(e.row,e.$index)}}},[t._v("编辑")]),s("el-popconfirm",{attrs:{title:"你确定要删除吗？",confirmButtonType:"danger"},on:{confirm:function(s){return t.delStatus(e.$index)}}},[s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),s("div",{staticClass:"chitrolBtn"},[s("el-button",{attrs:{type:"primary"},on:{click:t.submitStatusInfo}},[t._v("保存&下一步")]),s("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1),s("el-tab-pane",{attrs:{label:"流转设置",name:"flowSet"}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.flowList,border:""}},[s("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                从【"+t._s(e.row.src_status)+"】中可流转到\n              ")]}}])}),t._l(t.flowList,(function(e,o){return s("el-table-column",{key:o,attrs:{label:e.src_status},scopedSlots:t._u([{key:"default",fn:function(o){return[s("input",{attrs:{type:"checkbox"},domProps:{checked:o.row.dst_status.includes(e.src_status)},on:{click:function(s){return t.handleFlow(o.$index,e.src_status)}}})]}}],null,!0)})}))],2),s("div",{staticClass:"chitrolBtn"},[s("el-button",{attrs:{type:"primary"},on:{click:t.sumbitFlowInfo}},[t._v("保存")])],1)],1)],1)],1)]),s("el-dialog",{attrs:{width:"30vw",title:"mod"==t.formType?"修改状态":"新增状态",visible:t.statusDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.statusDialog=e},closed:t.closedDialog}},[s("el-form",{ref:"statusForm",attrs:{"label-width":"auto",model:t.statusForm,rules:t.statusRules}},[s("el-form-item",{attrs:{label:"状态名称",prop:"name",required:""}},[s("el-input",{attrs:{placeholder:"请输入状态名称"},model:{value:t.statusForm.name,callback:function(e){t.$set(t.statusForm,"name",e)},expression:"statusForm.name"}})],1),s("el-form-item",{attrs:{label:"状态说明",prop:"intro"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入状态说明"},model:{value:t.statusForm.intro,callback:function(e){t.$set(t.statusForm,"intro",e)},expression:"statusForm.intro"}})],1)],1),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.statusDialog=!1}}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.submitStatus}},[t._v("确 定")])],1)],1)],1)},a=[],i=s("bd86"),r=(s("7f7f"),s("75fc")),l=s("24d2"),c=(o={data:function(){return{project_id:"",activeName:"baseInfo",baseInfoForm:{name:"",intro:""},rules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},statusList:[],selectedOption:"",formType:"add",statusDialog:!1,statusForm:{name:"",intro:"",is_begin:0,is_end:0},statusRules:{name:[{required:!0,message:"请输入工作流名称",trigger:"blur"}]},activeStatusIndex:null,flowList:[]}},computed:{},components:{},filters:{},created:function(){this.project_id=this.$route.params.project_id,this.flowStatus()},onLoad:function(t){},onShow:function(){},mounted:function(){}},Object(i["a"])(o,"computed",{}),Object(i["a"])(o,"methods",{sumbitFlowInfo:function(){var t=this;Object(l["d"])({project_id:this.project_id,flow_id:"",actions:JSON.stringify(this.flowList)}).then((function(e){0==e.code&&t.$message({message:"保存流程成功",type:"success"})}))},flowActions:function(){var t=this;Object(l["e"])({project_id:this.project_id,flow_id:""}).then((function(e){console.log(e),t.flowList=e.data}))},handleFlow:function(t,e){var s=this.flowList[t].dst_status.indexOf(e);this.flowList[t].dst_status=-1!==s?[].concat(Object(r["a"])(this.flowList[t].dst_status.slice(0,s)),Object(r["a"])(this.flowList[t].dst_status.slice(s+1))):[].concat(Object(r["a"])(this.flowList[t].dst_status),[e])},handleBegin:function(t){this.statusList.map((function(e,s){e.is_begin=t==s?1:0}))},handleEnd:function(t){this.statusList[t].is_end=1==this.statusList[t].is_end?0:1,console.log(this.statusList)},flowStatus:function(){var t=this;Object(l["f"])({project_id:this.project_id,flow_id:""}).then((function(e){0==e.code&&(t.statusList=e.data?e.data:[])}))},submitStatusInfo:function(){var t=this;0!=this.statusList.length?Object(l["g"])({project_id:this.project_id,flow_id:"",status:JSON.stringify(this.statusList)}).then((function(e){0==e.code&&(t.$message({message:"保存状态成功",type:"success"}),t.activeName="flowSet",t.flowActions())})):this.$message({message:"请添加状态",type:"warning"})},closedDialog:function(){this.$refs["statusForm"].clearValidate(),this.statusForm={name:"",intro:"",is_begin:0,is_end:0},this.formType="add"},submitStatus:function(){var t=this;this.$refs["statusForm"].validate((function(e){e&&("mod"==t.formType?(t.$set(t.statusList,t.activeStatusIndex,t.statusForm),t.statusDialog=!1):(t.statusList.push(t.statusForm),t.statusDialog=!1))}))},addStatus:function(){this.formType="add",this.statusDialog=!0},delStatus:function(t){this.statusList.splice(t,1)},editSatus:function(t,e){this.activeStatusIndex=e,this.statusForm.name=t.name,this.statusForm.intro=t.intro,this.statusForm.is_begin=t.is_begin,this.statusForm.is_end=t.is_end,this.formType="mod",this.statusDialog=!0},submitBaseInfo:function(){this.activeName="statusSet"},back:function(){this.$router.go(-1)},changeTab:function(t){"flowSet"==t.name&&this.flowActions()}}),o),u=c,d=(s("456e"),s("2877")),f=Object(d["a"])(u,n,a,!1,null,"443281b8",null);e["default"]=f.exports},"24d2":function(t,e,s){"use strict";s.d(e,"d",(function(){return a})),s.d(e,"e",(function(){return i})),s.d(e,"f",(function(){return r})),s.d(e,"g",(function(){return l})),s.d(e,"a",(function(){return c})),s.d(e,"c",(function(){return u})),s.d(e,"h",(function(){return d})),s.d(e,"b",(function(){return f}));var o=s("365c"),n={addProject:"add",editProject:"mod",getProjectList:"list",delProject:"del",flowStautsMod:"flowStautsMod",flowStatus:"flowStatus",flowActions:"flowActions",flowActionMod:"flowActionMod"};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.flowActionMod,t,"api/project")}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.flowActions,t,"api/project")}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.flowStatus,t,"api/project")}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.flowStautsMod,t,"api/project")}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.addProject,t,"api/project")}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.editProject,t,"api/project")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.getProjectList,t,"api/project")}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].post(n.delProject,t,"api/project")}},"456e":function(t,e,s){"use strict";var o=s("e75c"),n=s.n(o);n.a},e75c:function(t,e,s){}}]);